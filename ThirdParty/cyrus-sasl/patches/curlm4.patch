--- /dev/null	2011-10-03 11:44:12.910711578 -0700
+++ cyrus-sasl-2.1.25/cmulocal/curl.m4	2011-10-10 11:09:54.031873315 -0700
@@ -0,0 +1,40 @@
+dnl
+dnl macros for configure.in to detect curl
+dnl $Id: curl.m4,v 1.11 2006/05/17 18:30:19 murch Exp $
+dnl
+
+AC_DEFUN([CMU_HAVE_CURL], [
+AC_REQUIRE([CMU_FIND_LIB_SUBDIR])
+AC_ARG_WITH(curl,[  --with-curl=PATH     use Curl from PATH],
+	with_curl=$withval, with_curl="yes")
+
+	save_CPPFLAGS=$CPPFLAGS
+	save_LDFLAGS=$LDFLAGS
+
+	if test -d $with_curl; then
+	  CPPFLAGS="${CPPFLAGS} -I${with_curl}/include"
+	  CMU_ADD_LIBPATH(${with_curl}/$CMU_LIB_SUBDIR)
+	fi
+
+case "$with_curl" in
+	no)
+	  with_curl="no";;
+	*) 
+	  dnl if curl has been compiled with the rsaref2 libraries,
+	  dnl we need to include the rsaref libraries in the crypto check
+                LIB_CURL="-lcurl"
+		AC_CHECK_HEADER(curl/curl.h, [
+			AC_CHECK_LIB(curl, curl_easy_getinfo,
+					with_curl="yes",
+					with_curl="no", $LIB_CURL)],
+			with_curl=no)
+		;;
+esac
+
+	if test "$with_curl" != "no"; then
+		AC_DEFINE(HAVE_CURL,[],[Do we have Curl?])
+	else
+		CPPFLAGS=$save_CPPFLAGS
+		LDFLAGS=$save_LDFLAGS
+	fi
+])
--- cyrus-sasl-2.1.25/saslauthd/configure.in.orig	2011-10-10 12:44:00.211872522 -0700
+++ cyrus-sasl-2.1.25/saslauthd/configure.in	2011-10-10 12:44:11.041877515 -0700
@@ -37,6 +37,10 @@
 AC_MSG_CHECKING(for OpenSSL)
 AC_MSG_RESULT($with_openssl)
 
+CMU_HAVE_CURL
+AC_MSG_CHECKING(for Curl)
+AC_MSG_RESULT($with_curl)
+
 SASL_DES_CHK
 
 dnl mechanism-related checking
@@ -87,6 +91,24 @@
   AC_DEFINE(HAVE_HTTPFORM,[],[Include HTTP form Support])
 fi
 
+AC_ARG_WITH(libxml2, [  --with-libxml2=PROG     script for libxml2 config [xml2-config] ],
+        with_libxml2=$withval,
+        with_libxml2=xml2-config)
+AC_ARG_ENABLE(zimbra, [  --enable-zimbra        enable Zimbra authentication module [yes] ],
+  authzimbra=$enableval,
+  authzimbra=yes)
+if test "$authzimbra" != no; then
+  if test -z "$with_libxml2"; then
+     AC_ERROR([Zimbra authentication requires libxml2])
+  fi
+  if test -z "$with_curl"; then
+     AC_ERROR([Zimbra authentication requires libcurl])
+  fi
+  AC_DEFINE(AUTH_ZIMBRA,[],[Include Zimbra Authentication Support])
+  LDFLAGS="$LDFLAGS `$with_libxml2 --libs`"
+  CPPFLAGS="$CPPFLAGS `$with_libxml2 --cflags`"
+fi
+
 AC_ARG_WITH(pam, [  --with-pam=DIR          use PAM (rooted in DIR) [yes] ],
 	with_pam=$withval,
 	with_pam=yes)
