<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlextras" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<zm:computeSearchContext var="context" default="mail" usecache="false"/>
<app:head title="${context.title}"/>

<body>

<c:set var="cid" value="${empty param.id ? context.searchResult.hits[0].id : param.id}"/>

<c:set var="toolbar">
	<td class='toolbar'>
		<input class="inputSubmit" type="submit" name="actspam" value="<fmt:message key="reportSpam"/>">
	</td>
	<td class='toolbar'>
		<input class="inputSubmit" type="submit" name="acttrash" value="<fmt:message key="delete"/>"/>
	</td>
	<td class='toolbar'>
		<select name="actionfid">
			<option selected disabled><fmt:message key="move"/></option>
			<zm:forEachFolder var="folder">
				<c:if test="${folder.isConversationMoveTarget}">
					<option value="m:${folder.id}" />${zm:repeatString('&nbsp;&nbsp;', folder.depth)}${fn:escapeXml(folder.name)}
				</c:if>
			</zm:forEachFolder>
		</select>
		<input class="inputSubmit" type="submit" name="actmove" value="<fmt:message key="move"/>">
	</td>
	<td class='toolbar'>
		<select name="action">
			<option selected disabled><fmt:message key="moreActions"/></option>
			<option value='read' class='actionOption'><fmt:message key="markAsRead"/></option>
			<option value='unread' class='actionOption'><fmt:message key="markAsUnread"/></option>
			<option value='star' class='actionOption'><fmt:message key="addStar"/></option>
			<option value='unstar' class='actionOption'><fmt:message key="removeStar"/></option>
			<option disabled>--------</option>
			<option disabled><fmt:message key="applyLabel"/></option>
			<zm:forEachTag var="tag">
				<option class='actionOption' value='<c:out value="${tag.id}"/>'><c:out value="${tag.name}"/></option>
			</zm:forEachTag>
			<option class='actionOption' value='new'><fmt:message key="newLabel"/></option>
		</select>
		<input class="inputSubmit" type="submit" value='<fmt:message key="go"/>'/>
	</td>
    <td class='toolbar'><a href="clv?offset=0"><fmt:message key="refresh"/></a></td>
    <td width=100%></td>
	<td>
		<nobr><app:searchPageLeft keys="${keys}" context="${context}" urlTarget="clv"/>&nbsp;</nobr>
	</td>
	<td>
		<nobr><app:searchPageOffset searchResult="${context.searchResult}"/>&nbsp;</nobr>
	</td>
	<td style='padding-right:9px'>
		<nobr><app:searchPageRight keys="${keys}" context="${context}" urlTarget="clv"/></nobr>
	</td>
</c:set>

<zm:getMailbox var="mailbox"/>
<app:view folders="true" tags="true" searches="true" contacts="true" mailbox="${mailbox}">
<div class="niftyMail">
	<b class="rtopNiftyMail">
		<b class="r1"></b>
		<b class="r2"></b>
		<b class="r3"></b>
		<b class="r4"></b>
	</b>

	<div class="inbox" id="inbox">
		<table border=0 cellpadding=0 cellspacing=0 width=100%>
			<tr>
					${toolbar}
			</tr>
			<tr>
				<td colspan=100 class='actions'>
					<fmt:message key="select"/>
					<a href='javascript:;'><fmt:message key="all"/></a>,
					<a href='javascript:;'><fmt:message key="none"/></a>,
					<a href='javascript:;'><fmt:message key="read"/></a>,
					<a href='javascript:;'><fmt:message key="unread"/></a>,
					<a href='javascript:;'><fmt:message key="starred"/></a>,
					<a href='javascript:;'><fmt:message key="unstarred"/></a>
				</td>
			</tr>
			<tr>
				<td colspan=100 class='inboxContent'>
					<table border=0 width=100% cellpadding=0 cellspacing=0>
						<c:forEach items="${context.searchResult.convHits}" var="conv" varStatus="status">
							<tr class="convRow" ${conv.isUnread ? ' style="font-weight:bold"' : ''}>
								<td width=10 class='convCell'>&nbsp;</td>
								<td width=20 class='convCell'><input type='checkbox' name='convCheckbox' value='1'/></td>
								<td width=20 class='convCell'>
									<app:img src="${conv.isFlagged ? 'star_on_sm_2.gif' : 'star_off_2.gif'}"/>
								</td>
								<td class='convCell convParts'>
									<c:out value="${conv.displayRecipients}" default="${zm:m(pageContext, 'unknownRecipient')}"/>
									<c:if test="${conv.messageCount > 1}">&nbsp;(${conv.messageCount})</c:if>
								</td>
								<td class='convCell convSubj'>
									<c:set var="tagNames" value="${fn:escapeXml(zm:getTagNames(pageContext, conv.tagIds))}"/>
									<span class="labelSmall">${tagNames}</span>
									<zm:currentResultUrl var="url" value="cv" index="${status.index}" context="${context}" usecache="true"/>
									<a class="subjLink" href="${url}" accesskey="p">
										<c:out value="${empty conv.subject ? zm:m(pageContext, 'noSubject') : zm:truncate(conv.subject,100,true)}"/>
									</a>
								</td>
								<td width=20 class='convCell'>
									<app:img src="${conv.hasAttachment ? 'paperclip.gif' : 'blank16.gif'}" width='15' height='15' border='0'/>
								</td>
								<td class='convCell convDate'>
									${fn:escapeXml(zm:displayMsgDate(pageContext, conv.date))}
								</td>
							</tr>
						</c:forEach>
					</table>
					<c:if test="${context.searchResult.size == 0}">
						<div class='noResults'><br><br><fmt:message key="noResultsFound"/><br><br></div>
					</c:if>
				</td>
			</tr>
			<tr>
				<td height=5></td>
			</tr>
			<tr>
					${toolbar}
			</tr>
			<tr>
				<td colspan=100 class='actions'>
					<fmt:message key="select"/>
					<a href='javascript:;'><fmt:message key="all"/></a>,
					<a href='javascript:;'><fmt:message key="none"/></a>,
					<a href='javascript:;'><fmt:message key="read"/></a>,
					<a href='javascript:;'><fmt:message key="unread"/></a>,
					<a href='javascript:;'><fmt:message key="starred"/></a>,
					<a href='javascript:;'><fmt:message key="unstarred"/></a>
				</td>
			</tr>
		</table>
	</div>
	<b class="rbottomNiftyMail">
		<b class="r4"></b>
		<b class="r3"></b>
		<b class="r2"></b>
		<b class="r1"></b>
	</b>
</div>
</app:view>
</body>
</html>
