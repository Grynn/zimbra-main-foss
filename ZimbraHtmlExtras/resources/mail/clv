<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlextras" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<zm:computeSearchContext var="context" default="mail" usecache="false"/>

<head>
    <title>${fn:escapeXml(context.title)}</title>

    <style type="text/css">
        @import url( "<c:url value="/style/nifty.css"/>" );
        @import url( "<c:url value="/style/common.css"/>" );
        @import url( "<c:url value="/style/mail.css"/>" );
    </style>

</head>
<body>

<c:set value="${empty param.id ? context.searchResult.hits[0].id : param.id}" var="cid"/>

<c:set var="toolbar">
    <td class='toolbar'>
        <button>Report Spam</button>
    </td>
    <td class='toolbar'>
        <button>Delete</button>
    </td>
    <td class='toolbar'>
        <select>
            <option selected disabled>More actions...</option>
            <option value='read' class='actionOption'>Mark as read</option>
            <option value='unread' class='actionOption'>Mark as unread</option>
            <option value='star' class='actionOption'>Add star</option>
            <option value='unstar' class='actionOption'>Remove star</option>
            <option disabled>--------</option>
            <option disabled>Apply label:</option>
            <zm:forEachTag var="tag">
                <option class='actionOption' value='<c:out value="${tag.id}"/>'>
                    <c:out value="${tag.name}"/>
                </option>
            </zm:forEachTag>
            <option class='actionOption' value='new'>New Label...</option>
        </select>
    </td>
    <td class='toolbar'><a href="clv?offset=0">Refresh</a></td>
    <td width=100%></td>
    <c:if test="${param.offset gt 0}">
        <c:url value="clv" var="url">
            <c:param name='offset' value='${context.searchResult.prevOffset}'/>
            <c:if test="${!empty context}"><c:param name='sc' value='${context.id}'/></c:if>
            <c:if test="${!empty param.sq}"><c:param name='sq' value='${param.sq}'/></c:if>
            <c:if test="${!empty param.sf}"><c:param name='sf' value='${param.sf}'/></c:if>
            <c:if test="${!empty param.st}"><c:param name='st' value='${param.st}'/></c:if>
        </c:url>
        <td class='toolbar'>
            <nobr><a href="${url}">&lt; Newer</a></nobr>
        </td>
    </c:if>
    <c:if test="${context.searchResult.size gt 0}">
        <td class='toolbar' id='paging'>
            <nobr><b>${context.searchResult.offset+1} - ${context.searchResult.offset+context.searchResult.size}</b>
            </nobr>
        </td>
    </c:if>
    <c:if test="${context.searchResult.hasMore}">
        <c:url value="clv" var="url">
            <c:param name='offset' value='${context.searchResult.nextOffset}'/>
            <c:if test="${!empty context}"><c:param name='sc' value='${context.id}'/></c:if>
            <c:if test="${!empty param.sq}"><c:param name='sq' value='${param.sq}'/></c:if>
            <c:if test="${!empty param.sf}"><c:param name='sf' value='${param.sf}'/></c:if>
            <c:if test="${!empty param.st}"><c:param name='st' value='${param.st}'/></c:if>
        </c:url>
        <td class='toolbar'>
            <nobr><a href="${url}">Older &gt;</a></nobr>
        </td>
    </c:if>
</c:set>

<zm:getMailbox var="mailbox"/>

<app:view mailbox="${mailbox}">

<div class="niftyMail">
<b class="rtopNiftyMail">
    <b class="r1"></b>
    <b class="r2"></b>
    <b class="r3"></b>
    <b class="r4"></b>
</b>

<div class="inbox" id="inbox">
    <table border=0 cellpadding=0 cellspacing=0 width=100%>
        <tr>
                ${toolbar}
        </tr>
        <tr>
            <td colspan=100 class='actions'>
                Select:
                <a href='javascript:;'>All</a>,
                <a href='javascript:;'>None</a>,
                <a href='javascript:;'>Read</a>,
                <a href='javascript:;'>Unread</a>,
                <a href='javascript:;'>Starred</a>,
                <a href='javascript:;'>Unstarred</a>
            </td>
        </tr>
        <tr>
            <td colspan=100 id='inboxContent' class='inboxContent'>
                <table border=0 width=100% cellpadding=0 cellspacing=0>
                    <c:forEach items="${context.searchResult.convHits}" var="conv" varStatus="status">
                        <tr class="convRow" ${conv.isUnread ? ' style="font-weight:bold"' : ''}>
                            <td width=10 class='convCell'>&nbsp;</td>
                            <td width=20 class='convCell'><input type='checkbox' name='convCheckbox'
                                                                 value='1'/></td>
                            <td width=20 class='convCell'>
                                <app:img src="${conv.isFlagged ? 'star_on_sm_2.gif' : 'star_off_2.gif'}"/>
                            </td>
                            <td class='convCell convParts'>
                                <c:out value="${conv.displayRecipients}"
                                       default="${zm:m(pageContext, 'unknownRecipient')}"/>
                                <c:if test="${conv.messageCount > 1}">&nbsp;(${conv.messageCount})</c:if>
                            </td>
                            <td class='convCell convSubj'>
                                <c:set var="tagNames"
                                       value="${fn:escapeXml(zm:getTagNames(pageContext, conv.tagIds))}"/>
                                <span class="labelSmall">${tagNames}</span>


                                <c:url value="cv" var="url">
                                    <c:param name='su' value='1'/>
                                    <c:param name='si' value='${status.index}'/>
                                    <c:param name='so' value='${context.searchResult.offset}'/>
                                    <c:if test="${!empty context}"><c:param name='sc' value='${context.id}'/></c:if>
                                    <c:if test="${!empty param.sq}"><c:param name='sq' value='${param.sq}'/></c:if>
                                    <c:if test="${!empty param.sfi}"><c:param name='sfi' value='${param.sfi}'/></c:if>
                                    <c:if test="${!empty param.sti}"><c:param name='sti' value='${param.sti}'/></c:if>
                                </c:url>
                                <a class="subjLink" href="${url}">
                                    <c:out value="${empty conv.subject ? zm:m(pageContext, 'noSubject') : zm:truncate(conv.subject,100,true)}"/>
                                </a>
                            </td>
                            <td width=20 class='convCell'>
                                <app:img src="${conv.hasAttachment ? 'paperclip.gif' : 'blank16.gif'}"
                                         width='15' height='15' border='0'/>
                            </td>
                            <td class='convCell convDate'>
                                    ${fn:escapeXml(zm:displayMsgDate(pageContext, conv.date))}
                            </td>
                        </tr>
                    </c:forEach>
                </table>
                <c:if test="${context.searchResult.size == 0}">
                    <div class='noResults'><br><br>No messages matched your search.<br><br></div>
                </c:if>
            </td>
        </tr>
        <tr>
            <td height=5></td>
        </tr>
        <tr>
                ${toolbar}
        </tr>
        <tr>
            <td colspan=100 class='actions'>
                Select:
                <a href='javascript:;'>All</a>,
                <a href='javascript:;'>None</a>,
                <a href='javascript:;'>Read</a>,
                <a href='javascript:;'>Unread</a>,
                <a href='javascript:;'>Starred</a>,
                <a href='javascript:;'>Unstarred</a>
            </td>
        </tr>
    </table>
</div>
<b class="rbottomNiftyMail">
    <b class="r4"></b>
    <b class="r3"></b>
    <b class="r2"></b>
    <b class="r1"></b>
</b>
</div>
</app:view>
</body>
</html>
