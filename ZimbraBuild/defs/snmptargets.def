
# __SNMP

snmp: $(RPM_DIR) snmp_stage $(BUILD_ROOT)/zimbrasnmp.spec
	(cd $(SNMP_DEST_ROOT); \
		rpmbuild  --target i386 --quiet --define '_rpmdir $(BUILD_ROOT)' \
		--buildroot=$(SNMP_DEST_ROOT) -bb $(BUILD_ROOT)/zimbrasnmp.spec )

$(BUILD_ROOT)/zimbrasnmp.spec:
	cp $(RPM_CONF_DIR)/Spec/Scripts/zimbrasnmp.pre $(BUILD_ROOT)
	cp $(RPM_CONF_DIR)/Spec/Scripts/zimbrasnmp.post $(BUILD_ROOT)
	cat $(RPM_CONF_DIR)/Spec/zimbrasnmp.spec | \
		sed -e 's/@@VERSION@@/$(VERSION_TAG)/' \
		-e 's/@@RELEASE@@/$(RELEASE)/' \
		-e 's/^Copyright:/$(RPMCOPYRIGHTSTR):/' \
		-e '/^%pre$$/ r zimbrasnmp.pre' \
		-e '/^%post$$/ r zimbrasnmp.post' > $(BUILD_ROOT)/zimbrasnmp.spec
	rm -f zimbrasnmp.pre
	rm -f zimbrasnmp.post
	echo "%attr(-, zimbra, zimbra) /opt/zimbra/snmp-5.1.2" >> \
		$(BUILD_ROOT)/zimbrasnmp.spec

snmp_stage: $(SNMP_COMPONENTS)

$(SNMP_DEST_DIR):
	mkdir -p $@

$(SNMP_DEST_DIR)/$(SNMP_DIR): $(SNMP_DEST_DIR)
	@echo "*** Creating SNMP"
	(cd $(SNMP_DEST_DIR); tar xzf $(SNMP_SOURCE).tar.gz;)
	cp $(RPM_CONF_DIR)/Conf/snmpd.conf.in $(SNMP_DEST_DIR)/$(SNMP_DIR)/share/snmp/snmpd.conf.in
	mkdir -p $(SNMP_DEST_DIR)/$(SNMP_DIR)/conf
	cp $(RPM_CONF_DIR)/Conf/snmp.conf $(SNMP_DEST_DIR)/$(SNMP_DIR)/conf/snmp.conf
	cp $(RPM_CONF_DIR)/Conf/snmp.conf $(SNMP_DEST_DIR)/$(SNMP_DIR)/share/snmp/snmp.conf
	cp $(RPM_CONF_DIR)/Conf/mibs/*mib $(SNMP_DEST_DIR)/$(SNMP_DIR)/share/snmp/mibs
