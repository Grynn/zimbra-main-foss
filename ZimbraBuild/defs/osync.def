# __OSync

OSYNC_VERSION_TAG := $(MAJOR).$(MINOR).$(BUILDNUM)
OSYNC_RAGEL_VERSION	:= 6.7
OSYNC_BOOST_VERSION	:= 1.47.0
osync: VERSION_TAG := $(MAJOR).$(MINOR).$(MICRO)_$(BUILDNUM).MACOSX_UB
osync: CUR_DEST_ROOT := $(OSYNC_DEST_ROOT) 
osync: CUR_PACKAGE_NAME := zimbra-osync
osync: $(PACKAGE_DIR) osync_stage

osync_stage: $(OSYNC_DEST_DIR)/build

$(OSYNC_DEST_DIR):
	mkdir -p $@

$(OSYNC_DEST_DIR)/osync: $(OSYNC_DEST_DIR) $(OSYNC_DEST_ROOT)/build

$(OSYNC_DEST_ROOT)/build:
	sed -i -e 's/0.10.0.8/$(OSYNC_VERSION_TAG)/g' $(OSYNC_DEST_ROOT)/Msync_osx-Info.plist
	(cd $(OSYNC_DEST_ROOT); \
	xcodebuild -project Msync_osx.xcodeproj -configuration Debug -scheme "Build DMG" BOOST_ROOT=/opt/octopus/boost-$(OSYNC_BOOST_VERSION)/ OPENSSL_ROOT=/opt/octopus/openssl-$(OPENSSL_VERSION) PATH=${PATH}:/opt/octopus/ragel-$(OSYNC_RAGEL_VERSION)/bin VERSIONER_PERL_PREFER_32_BIT=yes build
