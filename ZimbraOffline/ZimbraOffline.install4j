<?xml version="1.0" encoding="UTF-8"?>
<install4j version="4.0.8" transformSequenceNumber="1">
  <directoryPresets config="./build/dist" />
  <application name="Zimbra Desktop" distributionSourceDir="" applicationId="4062-5711-9195-4050" mediaDir="./install4j" mediaFilePattern="${compiler:sys.shortName}_${compiler:sys.platform}_${compiler:sys.version}" compression="6" lzmaCompression="true" pack200Compression="true" excludeSignedFromPacking="true" keepModificationTimes="true" shortName="zdesktop" publisher="Yahoo! Inc" publisherWeb="www.zimbra.com" version="0.84" allPathsRelative="true" backupOnSave="false" autoSave="true" convertDotsToUnderscores="true" macSignature="ZIMD" javaMinVersion="1.5" javaMaxVersion="1.5" allowBetaVM="true">
    <languages skipLanguageSelection="false">
      <principalLanguage id="en" customLocalizationFile="" />
      <additionalLanguages />
    </languages>
    <searchSequence>
      <registry />
      <envVar name="JAVA_HOME" />
      <envVar name="JDK_HOME" />
    </searchSequence>
    <variables>
      <variable name="offline_relabel" value="ALPHA" />
      <variable name="offline_version" value="0.1" />
      <variable name="offline_buildid" value="1" />
    </variables>
  </application>
  <files>
    <roots />
    <mountPoints>
      <mountPoint id="66" root="" location="jetty" mode="755" />
      <mountPoint id="239" root="" location="conf" mode="755" />
      <mountPoint id="240" root="" location="db" mode="755" />
      <mountPoint id="429" root="" location="log" mode="755" />
      <mountPoint id="430" root="" location="redolog" mode="755" />
      <mountPoint id="814" root="" location="lib" mode="755" />
      <mountPoint id="842" root="" location="store" mode="755" />
      <mountPoint id="843" root="" location="index" mode="755" />
      <mountPoint id="856" root="" location="zimlets" mode="755" />
      <mountPoint id="181400" root="" location="win32" mode="755" />
      <mountPoint id="181402" root="" location="macos" mode="755" />
      <mountPoint id="181404" root="" location="linux" mode="755" />
      <mountPoint id="235368" root="" location="zdesktop.webapp" mode="755" />
      <mountPoint id="271586" root="" location="profile" mode="755" />
      <mountPoint id="4668" root="" location="" mode="755" />
    </mountPoints>
    <entries>
      <dirEntry mountPoint="66" file="./build/dist/jetty" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="*.zgz" dirMode="755">
        <exclude>
          <entry location="lib/ext" launcher="false" />
          <entry location="webapps/zimbra/help/webhelp.jar" launcher="false" />
        </exclude>
      </dirEntry>
      <dirEntry mountPoint="239" file="./build/dist/conf" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="240" file="./build/dist/db" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="814" file="./build/dist/lib" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="856" file="./build/dist/zimlets" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="181400" file="./build/dist/win32" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="181402" file="./build/dist/macos" overwrite="1" shared="false" mode="755" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="181404" file="./build/dist/linux" overwrite="1" shared="false" mode="755" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="235368" file="./build/dist/zdesktop.webapp" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="271586" file="./build/dist/profile" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <fileEntry mountPoint="4668" file="./build/dist/README.txt" overwrite="1" shared="false" mode="644" uninstallMode="2" />
    </entries>
    <components />
  </files>
  <launchers>
    <launcher name="Zimbra Desktop Service" id="32" external="false" excludeFromMenu="true" menuName="" icnsFile="" pngIcon16File="./src/installer/resources/launcher_16x16.png" pngIcon32File="./src/installer/resources/launcher_32x32.png" macServiceDependencies="" swtApp="false">
      <executable name="zdesktop" type="1" iconSet="false" iconFile="" executableDir="." redirectStderr="true" stderrFile="log/zdesktop.err" redirectStdout="true" stdoutFile="log/zdesktop.out" failOnStderrOutput="true" executableMode="3" changeWorkingDirectory="true" workingDirectory="log" singleInstance="true" serviceStartType="2" serviceDependencies="" serviceDescription="Zimbra Desktop Service" jreLocation="" executionLevel="asInvoker">
        <versionInfo include="false" fileVersion="" fileDescription="" legalCopyright="" internalName="" />
      </executable>
      <splashScreen show="false" autoOff="true" alwaysOnTop="true" width="0" height="0" bitmapFile="">
        <text>
          <statusLine x="20" y="20" text="" font="Arial" fontSize="8" fontColor="0,0,0" fontWeight="500" />
          <versionLine x="20" y="40" text="version ${compiler:sys.version}" font="Arial" fontSize="8" fontColor="0,0,0" fontWeight="500" />
        </text>
      </splashScreen>
      <java mainClass="com.zimbra.cs.offline.start.Main" vmParameters="-Xms64m -Xmx256m -Dsun.net.inetaddr.ttl=30 -DSTART=${launcher:sys.launcherDirectory}jetty/etc/start.config -Dzimbra.config=${launcher:sys.launcherDirectory}conf/localconfig.xml -Djava.library.path=${launcher:sys.launcherDirectory}lib -Djava.awt.headless=true" arguments="org.mortbay.start.Main" allowVMPassthroughParameters="false" preferredVM="">
        <classPath>
          <archive location="lib/zdesktop.jar" failOnError="false" />
          <archive location="jetty/start.jar" failOnError="false" />
        </classPath>
        <nativeLibraryDirectories />
      </java>
      <includedFiles />
      <unextractableFiles />
      <customScript mode="1" file="">
        <scriptLines />
      </customScript>
    </launcher>
  </launchers>
  <installerGui installerType="1" suggestPreviousProgramGroup="true" addOnAppId="" suggestPreviousLocations="true" allowUnattended="true" allowConsole="true" useCustomInstallerHeaderImage="true" customInstallerHeaderImage="./src/installer/resources/installer_60x60.png" useCustomUninstallerHeaderImage="true" customUninstallerHeaderImage="./src/installer/resources/installer_60x60.png" customSize="false" customWidth="500" customHeight="390" useCustomIcon="true" customIcnsFile="./src/installer/resources/launcher_128x128.icns" customPngIcon16File="./src/installer/resources/launcher_16x16.png" customPngIcon32File="./src/installer/resources/launcher_32x32.png" customIcoFile="" vmParameters="" watermark="true" resizable="true" suppressProgressDialog="false">
    <customCode useInstalledFiles="false">
      <archive location="../ZimbraCommon/jars/log4j-1.2.8.jar" />
      <archive location="./jars/derby.jar" />
      <archive location="./tools/lib/derbytools.jar" />
      <archive location="./build/dist/jetty/common/lib/dom4j-1.5.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-cli-2.0.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-codec-1.3.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-httpclient-3.0.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-logging.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-collections-3.1.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-dbcp-1.1.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-pool-1.1.jar" />
      <archive location="./build/dist/jetty/common/lib/mail.jar" />
      <archive location="./build/dist/jetty/common/lib/zimbracommon.jar" />
      <archive location="./build/dist/jetty/webapps/service/WEB-INF/lib/zimbrastore.jar" />
      <archive location="./build/dist/jetty/webapps/service/WEB-INF/lib/zimbraoffline.jar" />
    </customCode>
    <installerScreens>
      <screen name="" id="1" beanClass="com.install4j.runtime.beans.screens.WelcomeScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.WelcomeScreen">
              <void property="bannerBackground">
                <object class="java.awt.Color">
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                </object>
              </void>
              <void property="bannerImageFile">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/installer_banner.png</string>
                </object>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions />
        <formComponents />
      </screen>
      <screen name="" id="92171" beanClass="com.install4j.runtime.beans.screens.LicenseScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.LicenseScreen">
              <void property="displayedText">
                <string>&lt;html&gt;
&lt;body&gt;
PLEASE READ THIS AGREEMENT CAREFULLY BEFORE USING THE SOFTWARE.
ZIMBRA, INC. ("ZIMBRA") WILL ONLY LICENSE THIS SOFTWARE TO YOU IF YOU
FIRST ACCEPT THE TERMS OF THIS AGREEMENT. BY DOWNLOADING OR INSTALLING
THE SOFTWARE, OR USING THE PRODUCT, YOU ARE CONSENTING TO BE BOUND BY
THIS AGREEMENT. IF YOU DO NOT AGREE TO ALL OF THE TERMS OF THIS
AGREEMENT, THEN DO NOT DOWNLOAD, INSTALL OR USE THE PRODUCT.
&lt;p&gt;
License Terms for this Zimbra Collaboration Suite Software:&lt;br&gt;
&lt;a href="http://www.zimbra.com/license/zimbra_public_eula_2.1.html"&gt;http://www.zimbra.com/license/zimbra_public_eula_2.1.html&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</string>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions />
        <formComponents />
      </screen>
      <screen name="uninstall" id="6165" beanClass="com.install4j.runtime.beans.screens.DefaultInfoScreen" rollbackBarrier="false" backButton="3" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.DefaultInfoScreen">
              <void property="displayedText">
                <string>A previous installation of Zimbra Desktop has been detected.
It must be uninstalled before proceeding with new installation.</string>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition>context.getBooleanVariable("needToUninstall")</condition>
        <validation />
        <actions>
          <action name="" id="271582" beanClass="com.install4j.runtime.beans.actions.services.StopServiceAction" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.services.StopServiceAction">
                  <void property="launcherId">
                    <string>32</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isMacOS()</condition>
          </action>
          <action name="launchctl stop" id="271581" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="2">
                      <void index="0">
                        <string>stop</string>
                      </void>
                      <void index="1">
                        <string>com.zimbra.zdesktop</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/bin/launchctl</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="migration test run" id="271585" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

String errorMsg = null;

try {
    Thread.sleep(1000);
    new com.zimbra.cs.db.DbOfflineMigration().testRun();
    return true;
} catch (com.zimbra.cs.db.DbExclusiveAccessException x) {
    Thread.sleep(6000);
    try {
        new com.zimbra.cs.db.DbOfflineMigration().testRun();
        return true;
    } catch (com.zimbra.cs.db.DbExclusiveAccessException e) {
        Util.showMessage("Background service of previous version not shutdown.  Please rerun this installer after it's completely shutdown.",
                javax.swing.JOptionPane.WARNING_MESSAGE);
        return false;
    }
} catch (com.zimbra.cs.db.DbNotFoundException x) {
    errorMsg = "Some parts of your existing dataset is missing.";
} catch (com.zimbra.cs.db.DbDataCorruptedException x) {
    errorMsg = "Your existing dataset is corrupted and can't be recovered.";
} catch (com.zimbra.cs.db.DbUnsupportedVersionException x) {
    errorMsg = "Your existing dataset version is too old and can't be converted.";
} catch (com.zimbra.cs.db.DbUpdateException x) {
    errorMsg = "Your existing dataset is not compatible and can't be converted.";
} catch (Exception x) {
    errorMsg = "Your existing dataset can't be reused.";
}

int choice = Util.showOptionDialog(errorMsg, new String[] {"Quit", "Delete old dataset and continue with install"},
        javax.swing.JOptionPane.WARNING_MESSAGE);

switch (choice) {
case 1:
    context.setVariable("keepUserData", Boolean.FALSE);
    return true;
default:
    return false;
}</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("keepUserData")</condition>
          </action>
        </actions>
        <formComponents />
      </screen>
      <screen name="uninstall" id="275891" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
              <void property="subTitle">
                <string>Please wait while the previous version is being removed...</string>
              </void>
              <void property="title">
                <string>Uninstalling</string>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition>context.getBooleanVariable("needToUninstall")</condition>
        <validation />
        <actions>
          <action name="" id="275899" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                  <void property="statusMessage">
                    <string>Uninstalling Previous Version</string>
                  </void>
                  <void property="useStatus">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="" id="275900" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                  <void property="progressChangeType">
                    <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_TIMER" />
                  </void>
                  <void property="timerPeriod">
                    <int>200</int>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="launchctl remove" id="275894" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="2">
                      <void index="0">
                        <string>remove</string>
                      </void>
                      <void index="1">
                        <string>com.zimbra.zdesktop</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/bin/launchctl</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="macos uninstaller" id="275895" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="1">
                      <void index="0">
                        <string>-q</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/Zimbra Desktop Uninstaller.app/Contents/MacOS/JavaApplicationStub</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="win32 uninstaller" id="275896" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="1">
                      <void index="0">
                        <string>-q</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/uninstall.exe</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isWindows()</condition>
          </action>
          <action name="linux uninstaller" id="275897" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="1">
                      <void index="0">
                        <string>-q</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/uninstall</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
          </action>
          <action name="check uninstall" id="275898" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="Previous version can't be uninstalled.  New install can't continue.">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>String appId = context.getApplicationId();

ApplicationRegistry.ApplicationInfo[] appInfoList = ApplicationRegistry.getApplicationInfoById(appId);
if (appInfoList != null &amp;&amp; appInfoList.length &gt; 0) {
    return false;
}

return true;</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="migration" id="275901" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

String errorMsg = null;

try {
    new com.zimbra.cs.db.DbOfflineMigration().run();
    return true;
} catch (com.zimbra.cs.db.DbExclusiveAccessException x) {
    Thread.sleep(5000);
    try {
        new com.zimbra.cs.db.DbOfflineMigration().testRun();
        return true;
    } catch (com.zimbra.cs.db.DbExclusiveAccessException e) {
        Util.showMessage("Background service of previous version not shutdown.  Please rerun this installer after it's completely shutdown.",
                javax.swing.JOptionPane.WARNING_MESSAGE);
        return false;
    }
} catch (com.zimbra.cs.db.DbNotFoundException x) {
    errorMsg = "Some parts of your existing dataset is missing.";
} catch (com.zimbra.cs.db.DbDataCorruptedException x) {
    errorMsg = "Your existing dataset is corrupted and can't be recovered.";
} catch (com.zimbra.cs.db.DbUnsupportedVersionException x) {
    errorMsg = "Your existing dataset version is too old and can't be converted.";
} catch (com.zimbra.cs.db.DbUpdateException x) {
    errorMsg = "Your existing dataset is not compatible and can't be converted.";
} catch (Exception x) {
    errorMsg = "Your existing dataset can't be reused.";
}

int choice = Util.showOptionDialog(errorMsg, new String[] {"Quit", "Delete old dataset and continue with install"},
        javax.swing.JOptionPane.WARNING_MESSAGE);

switch (choice) {
case 1:
    context.setVariable("keepUserData", Boolean.FALSE);
    return true;
default:
    return false;
}</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="derby" id="275903" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>derby</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="index" id="275904" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>index</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="store" id="275905" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>store</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="redolog" id="275906" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>redolog</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="log" id="275907" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>log</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="win32" id="275908" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>win32</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="linux" id="275909" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>linux</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="macos" id="275910" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>macos</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="zdesktop.webapp" id="275911" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zdesktop.webapp</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="profile" id="275912" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>profile</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="zimlets" id="275913" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zimlets</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="db" id="275914" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>db</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="conf" id="275915" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>conf</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="lib" id="275916" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>lib</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="jetty" id="275917" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="Uninstaller.app" id="284391" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>Zimbra Desktop Uninstaller.app</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="zdesktop" id="275918" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
        </actions>
        <formComponents />
      </screen>
      <screen name="" id="2" beanClass="com.install4j.runtime.beans.screens.InstallationDirectoryScreen" rollbackBarrier="false" backButton="3" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.InstallationDirectoryScreen" />
          </java>
        </serializedBean>
        <condition>!context.getBooleanVariable("keepUserData")</condition>
        <validation />
        <actions>
          <action name="sys.installationDir" id="275920" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>String installDir = context.getVariable("sys.installationDir").toString();
if (installDir.indexOf(" ") &gt;= 0) {
    if (Util.isWindows())
        return "C:\\zimbra\\zdesktop";
    else
        return context.getVariable("sys.userHome").toString() + "/zdesktop";
} else
    return installDir;</string>
                      </void>
                    </object>
                  </void>
                  <void property="variableName">
                    <string>sys.installationDir</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
        </actions>
        <formComponents />
      </screen>
      <screen name="" id="5" beanClass="com.install4j.runtime.beans.screens.InstallationScreen" rollbackBarrier="true" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.InstallationScreen" />
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions>
          <action name="clear error" id="275927" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>context.setErrorOccured(false);
return true;</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="" id="6" beanClass="com.install4j.runtime.beans.actions.InstallFilesAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.InstallFilesAction">
                  <void property="fileFilterScript">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string />
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="README" id="92226" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                  <void property="suffixes">
                    <array class="java.lang.String" length="1">
                      <void index="0">
                        <string>.txt</string>
                      </void>
                    </array>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="conf" id="92224" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>conf</string>
                    </object>
                  </void>
                  <void property="recursive">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="jetty" id="92395" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty</string>
                    </object>
                  </void>
                  <void property="suffixes">
                    <array class="java.lang.String" length="1">
                      <void index="0">
                        <string>.txt</string>
                      </void>
                    </array>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="jetty/LICENSES" id="92393" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty/LICENSES</string>
                    </object>
                  </void>
                  <void property="recursive">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="jetty/etc" id="92392" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty/etc</string>
                    </object>
                  </void>
                  <void property="recursive">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="jetty/resources" id="92394" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty/resources</string>
                    </object>
                  </void>
                  <void property="recursive">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="localconfig.xml" id="850" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>conf/localconfig.xml</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>${installer:sys.installationDir}</string>
                  </void>
                  <void property="searchValue">
                    <string>@install@</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="start.config" id="1143" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty/etc/start.config</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>${installer:sys.installationDir}</string>
                  </void>
                  <void property="searchValue">
                    <string>/opt/zimbra/zdesktop</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="derbyij.sql" id="263088" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>db/derbyij.sql</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>${installer:sys.installationDir}</string>
                  </void>
                  <void property="searchValue">
                    <string>@install@</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="derbyij" id="263089" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="Failed to initialize database">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

try {
    File f = context.getDestinationFile("db" + File.separator + "derbyij.sql");
    org.apache.derby.tools.ij.main(new String[] {f.getAbsolutePath()});
    return true;
} catch (Exception x) {
    context.setErrorOccured(true);
    return false;
}</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.getBooleanVariable("keepUserData")</condition>
          </action>
          <action name="" id="8" beanClass="com.install4j.runtime.beans.actions.desktop.RegisterAddRemoveAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.desktop.RegisterAddRemoveAction">
                  <void property="icon">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./src/installer/resources/launcher_16x16.ico</string>
                    </object>
                  </void>
                  <void property="itemName">
                    <string>${compiler:sys.fullName} ${compiler:sys.version}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.isErrorOccured()</condition>
          </action>
        </actions>
        <formComponents />
      </screen>
      <screen name="" id="5391" beanClass="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" rollbackBarrier="false" backButton="3" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" />
          </java>
        </serializedBean>
        <condition>!context.isErrorOccured()</condition>
        <validation />
        <actions>
          <action name="windows" id="145792" beanClass="com.install4j.runtime.beans.actions.desktop.CreateDesktopLinkAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.desktop.CreateDesktopLinkAction">
                  <void property="allUsers">
                    <boolean>false</boolean>
                  </void>
                  <void property="arguments">
                    <string>-webapp ..\..\zdesktop.webapp -profile ..\..\profile</string>
                  </void>
                  <void property="description">
                    <string>${compiler:sys.fullName}</string>
                  </void>
                  <void property="file">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/win32/prism/prism.exe</string>
                    </object>
                  </void>
                  <void property="name">
                    <string>${compiler:sys.fullName}</string>
                  </void>
                  <void property="winIconFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./build/dist/win32/launcher_32x32.ico</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isWindows() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
          </action>
          <action name="windows" id="145797" beanClass="com.install4j.runtime.beans.actions.desktop.CreateStartMenuEntryAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.desktop.CreateStartMenuEntryAction">
                  <void property="allUsers">
                    <boolean>false</boolean>
                  </void>
                  <void property="arguments">
                    <string>-webapp ..\..\zdesktop.webapp -profile ..\..\profile</string>
                  </void>
                  <void property="entryName">
                    <string>Zimbra Desktop</string>
                  </void>
                  <void property="file">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/win32/prism/prism.exe</string>
                    </object>
                  </void>
                  <void property="icon">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./build/dist/win32/launcher_32x32.ico</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isWindows()</condition>
          </action>
          <action name="macos.app" id="145799" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/MacOS/zdesktop</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>${installer:sys.installationDir}</string>
                  </void>
                  <void property="searchValue">
                    <string>@install@</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="" id="212570" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/MacOS/zdesktop</string>
                    </object>
                  </void>
                  <void property="mode">
                    <string>755</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="applications/macos.app/Info.plist" id="168012" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>/Applications/Zimbra Desktop.app/Contents/Info.plist</string>
                    </object>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/Info.plist</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="applications/macos.app/icns" id="168014" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>/Applications/Zimbra Desktop.app/Contents/Resources/launcher_128x128.icns</string>
                    </object>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/Resources/launcher_128x128.icns</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="applications/macos.app/zdesktop" id="168013" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>/Applications/Zimbra Desktop.app/Contents/MacOS/zdesktop</string>
                    </object>
                  </void>
                  <void property="mode">
                    <string>755</string>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/MacOS/zdesktop</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="" id="207852" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>/Applications/Zimbra Desktop.app</string>
                    </object>
                  </void>
                  <void property="mode">
                    <string>775</string>
                  </void>
                  <void property="recursive">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="desktop/macos.app/Info.plist" id="145800" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>${installer:sys.userHome}/Desktop/Zimbra Desktop.app/Contents/Info.plist</string>
                    </object>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/Info.plist</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
          </action>
          <action name="desktop/macos.app/icns" id="145815" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>${installer:sys.userHome}/Desktop/Zimbra Desktop.app/Contents/Resources/launcher_128x128.icns</string>
                    </object>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/Resources/launcher_128x128.icns</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
          </action>
          <action name="desktop/macos.app/zdesktop" id="145814" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>${installer:sys.userHome}/Desktop/Zimbra Desktop.app/Contents/MacOS/zdesktop</string>
                    </object>
                  </void>
                  <void property="mode">
                    <string>755</string>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/macos.app/Contents/MacOS/zdesktop</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
          </action>
          <action name="" id="203135" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>${installer:sys.userHome}/Desktop/Zimbra Desktop.app</string>
                    </object>
                  </void>
                  <void property="mode">
                    <string>775</string>
                  </void>
                  <void property="recursive">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
          </action>
          <action name="linux.desktop" id="145819" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>linux/linux.desktop</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>${installer:sys.installationDir}</string>
                  </void>
                  <void property="searchValue">
                    <string>@install@</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
          </action>
          <action name="linux.desktop" id="145820" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>${installer:sys.userHome}/Desktop/linux.desktop</string>
                    </object>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>linux/linux.desktop</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
          </action>
          <action name="clear error" id="275928" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>context.setErrorOccured(false);
return true;</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
        </actions>
        <formComponents>
          <formComponent name="Add a desktop link" id="5392" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                  <void property="checkboxText">
                    <string>${i18n:CreateDesktopIcon}</string>
                  </void>
                  <void property="initiallySelected">
                    <boolean>true</boolean>
                  </void>
                  <void property="variableName">
                    <string>createDesktopLinkAction</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <initScript />
          </formComponent>
        </formComponents>
      </screen>
      <screen name="launch" id="4229" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
              <void property="subTitle">
                <string>Waiting for Core Service to initialize...</string>
              </void>
              <void property="title">
                <string>Starting Zimbra Desktop Core Service</string>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition>!context.isErrorOccured()</condition>
        <validation />
        <actions>
          <action name="zdesktop" id="145686" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zdesktop</string>
                    </object>
                  </void>
                  <void property="searchValue">
                    <string>nohup</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="zdesktop" id="145687" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zdesktop</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>org.mortbay.start.Main</string>
                  </void>
                  <void property="searchValue">
                    <string>org.mortbay.start.Main &amp;</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="zdesktop" id="62119" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zdesktop</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>-1  &gt; $prg_dir/log/zdesktop.out &amp;</string>
                  </void>
                  <void property="searchValue">
                    <string>-1  &amp;</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>false &amp;&amp; Util.isMacOS()</condition>
          </action>
          <action name="zdesktop" id="68534" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zdesktop</string>
                    </object>
                  </void>
                  <void property="mode">
                    <string>755</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="launchd.plist" id="5292" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>macos/launchd.plist</string>
                    </object>
                  </void>
                  <void property="replaceValue">
                    <string>${installer:sys.installationDir}</string>
                  </void>
                  <void property="searchValue">
                    <string>@install@</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="launchd.plist" id="6149" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                  <void property="destinationFile">
                    <object class="java.io.File">
                      <string>${installer:sys.userHome}/Library/LaunchAgents/com.zimbra.zdesktop.plist</string>
                    </object>
                  </void>
                  <void property="overwriteMode">
                    <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                  </void>
                  <void property="sourceFile">
                    <object class="java.io.File">
                      <string>macos/launchd.plist</string>
                    </object>
                  </void>
                  <void property="uninstallMode">
                    <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
          </action>
          <action name="launchctl" id="145688" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="2">
                      <void index="0">
                        <string>load</string>
                      </void>
                      <void index="1">
                        <string>${installer:sys.userHome}/Library/LaunchAgents/com.zimbra.zdesktop.plist</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/bin/launchctl</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
          </action>
          <action name="launchctl" id="5294" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="2">
                      <void index="0">
                        <string>start</string>
                      </void>
                      <void index="1">
                        <string>com.zimbra.zdesktop</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/bin/launchctl</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>log</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
          </action>
          <action name="" id="263046" beanClass="com.install4j.runtime.beans.actions.services.InstallServiceAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="Failed to install Zimbra Desktop core service.">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.services.InstallServiceAction">
                  <void property="allowUserChangeStartType">
                    <boolean>false</boolean>
                  </void>
                  <void property="launcherId">
                    <string>32</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
          </action>
          <action name="" id="263047" beanClass="com.install4j.runtime.beans.actions.services.StartServiceAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="Failed to start Zimbra Desktop core service.">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.services.StartServiceAction">
                  <void property="launcherId">
                    <string>32</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
          </action>
          <action name="" id="4230" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                  <void property="statusMessage">
                    <string>Starting Zimbra Desktop Core Service</string>
                  </void>
                  <void property="useStatus">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.isErrorOccured()</condition>
          </action>
          <action name="" id="4231" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                  <void property="progressChangeType">
                    <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_TIMER" />
                  </void>
                  <void property="timerPeriod">
                    <int>100</int>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.isErrorOccured()</condition>
          </action>
          <action name="zimlets" id="4232" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="Failed to inject zimlets.  Some features may be missing.">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

org.apache.log4j.Logger.getRootLogger().setLevel(org.apache.log4j.Level.OFF);

org.apache.commons.httpclient.HttpClient client = new org.apache.commons.httpclient.HttpClient();
String url = "http://localhost:7634/service/admin/soap";
org.apache.commons.httpclient.methods.GetMethod get = new org.apache.commons.httpclient.methods.GetMethod(url);

boolean isServiceUp = false;
for (int i = 0; i &lt; 3; ++i) {
	Thread.sleep(5000);
    try {
        client.executeMethod(get);
        int status = get.getStatusCode();
        if (status == 405) { //when service not up we get 404; 405 means GET not supported but service is up
            isServiceUp = true;
            break;
        }
    } catch (Throwable t) {
    } finally {
        get.releaseConnection();
    }
}

if (!isServiceUp) return false;

File zimletsDir = context.getDestinationFile("zimlets");

FilenameFilter fnf = new FilenameFilter() {
    public boolean accept(File dir, String name) {
        return name.endsWith(".zip");
    } 
};

File[] zimlets = zimletsDir.listFiles(fnf);
boolean hasFailures = false;
for (int i = 0; i &lt; zimlets.length; ++i) {
    try {
        com.zimbra.cs.zimlet.ZimletUtil.main(new String[] {"-q", "deploy", zimlets[i].getAbsolutePath()});
        zimlets[i].delete();
    } catch (Exception x) {
        hasFailures = true;
    }
}

return !hasFailures;</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.isErrorOccured()</condition>
          </action>
        </actions>
        <formComponents />
      </screen>
      <screen name="" id="9" beanClass="com.install4j.runtime.beans.screens.FinishedScreen" rollbackBarrier="false" backButton="2" finishScreen="true">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.FinishedScreen">
              <void property="bannerBackground">
                <object class="java.awt.Color">
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                </object>
              </void>
              <void property="bannerImageFile">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/installer_banner.png</string>
                </object>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition>!context.isErrorOccured()</condition>
        <validation />
        <actions>
          <action name="windows" id="181367" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="4">
                      <void index="0">
                        <string>-webapp</string>
                      </void>
                      <void index="1">
                        <string>${installer:sys.installationDir}\zdesktop.webapp</string>
                      </void>
                      <void index="2">
                        <string>-profile</string>
                      </void>
                      <void index="3">
                        <string>${installer:sys.installationDir}\profile</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/win32/prism/prism.exe</string>
                    </object>
                  </void>
                  <void property="logArguments">
                    <boolean>true</boolean>
                  </void>
                  <void property="stderrFile">
                    <object class="java.io.File">
                      <string>log/app.err</string>
                    </object>
                  </void>
                  <void property="stdoutFile">
                    <object class="java.io.File">
                      <string>log/app.out</string>
                    </object>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>log</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isWindows() &amp;&amp; context.getBooleanVariable("launch")</condition>
          </action>
          <action name="macos" id="154832" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="1">
                      <void index="0">
                        <string>${installer:sys.installationDir}/macos/macos.app</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/usr/bin/open</string>
                    </object>
                  </void>
                  <void property="logArguments">
                    <boolean>true</boolean>
                  </void>
                  <void property="stderrFile">
                    <object class="java.io.File">
                      <string>log/app.err</string>
                    </object>
                  </void>
                  <void property="stdoutFile">
                    <object class="java.io.File">
                      <string>log/app.out</string>
                    </object>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>log</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("launch")</condition>
          </action>
          <action name="linux" id="181368" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="4">
                      <void index="0">
                        <string>-webapp</string>
                      </void>
                      <void index="1">
                        <string>${installer:sys.installationDir}/zdesktop.webapp</string>
                      </void>
                      <void index="2">
                        <string>-profile</string>
                      </void>
                      <void index="3">
                        <string>${installer:sys.installationDir}/profile</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>${installer:sys.installationDir}/linux/prism/prism</string>
                    </object>
                  </void>
                  <void property="logArguments">
                    <boolean>true</boolean>
                  </void>
                  <void property="stderrFile">
                    <object class="java.io.File">
                      <string>log/app.err</string>
                    </object>
                  </void>
                  <void property="stdoutFile">
                    <object class="java.io.File">
                      <string>log/app.out</string>
                    </object>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>log</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS() &amp;&amp; context.getBooleanVariable("launch")</condition>
          </action>
        </actions>
        <formComponents>
          <formComponent name="" id="3856" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                  <void property="checkboxText">
                    <string>Launch Zimbra Desktop</string>
                  </void>
                  <void property="initiallySelected">
                    <boolean>true</boolean>
                  </void>
                  <void property="variableName">
                    <string>launch</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <initScript />
          </formComponent>
        </formComponents>
      </screen>
    </installerScreens>
    <uninstallerScreens>
      <screen name="" id="10" beanClass="com.install4j.runtime.beans.screens.UninstallWelcomeScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.UninstallWelcomeScreen">
              <void property="bannerBackground">
                <object class="java.awt.Color">
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                </object>
              </void>
              <void property="bannerImageFile">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/installer_banner.png</string>
                </object>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions />
        <formComponents />
      </screen>
      <screen name="" id="109908" beanClass="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" />
          </java>
        </serializedBean>
        <condition>true || !context.getBooleanVariable("wipeUserData")</condition>
        <validation />
        <actions />
        <formComponents>
          <formComponent name="" id="109909" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                  <void property="checkboxText">
                    <string>Delete ENTIRE local dataset</string>
                  </void>
                  <void property="variableName">
                    <string>wipeUserData</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <initScript />
          </formComponent>
          <formComponent name="" id="109911" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                  <void property="labelColor">
                    <object class="java.awt.Color">
                      <int>255</int>
                      <int>0</int>
                      <int>0</int>
                      <int>255</int>
                    </object>
                  </void>
                  <void property="labelText">
                    <string>NOTE: Select this option ONLY if you want to permanently remove all downloaded data from local computer!</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <initScript />
          </formComponent>
        </formComponents>
      </screen>
      <screen name="" id="11" beanClass="com.install4j.runtime.beans.screens.UninstallationScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.UninstallationScreen" />
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions>
          <action name="" id="95843" beanClass="com.install4j.runtime.beans.actions.services.StopServiceAction" rollbackBarrier="false" multiExec="true" failureStrategy="3" errorMessage="Can't stop background service">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.services.StopServiceAction">
                  <void property="launcherId">
                    <string>32</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Util.isMacOS()</condition>
          </action>
          <action name="launchctl stop" id="5382" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="Can't stop background service">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="2">
                      <void index="0">
                        <string>stop</string>
                      </void>
                      <void index="1">
                        <string>com.zimbra.zdesktop</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/bin/launchctl</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="launchctl remove" id="145683" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                  <void property="arguments">
                    <array class="java.lang.String" length="2">
                      <void index="0">
                        <string>remove</string>
                      </void>
                      <void index="1">
                        <string>com.zimbra.zdesktop</string>
                      </void>
                    </array>
                  </void>
                  <void property="executable">
                    <object class="java.io.File">
                      <string>/bin/launchctl</string>
                    </object>
                  </void>
                  <void property="wait">
                    <boolean>true</boolean>
                  </void>
                  <void property="workingDirectory">
                    <object class="java.io.File">
                      <string>.</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>Util.isMacOS()</condition>
          </action>
          <action name="jetty" id="95844" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>jetty</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="lib" id="95858" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>lib</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="conf" id="95848" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>conf</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="db" id="95852" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>db</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="zimlets" id="271563" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zimlets</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="profile" id="95856" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>profile</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="zdesktop.webapp" id="271564" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>zdesktop.webapp</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="macos" id="271565" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>macos</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="linux" id="271566" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>linux</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="win32" id="271567" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>win32</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="log" id="95851" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>log</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("wipeUserData")</condition>
          </action>
          <action name="redolog" id="95850" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>redolog</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("wipeUserData")</condition>
          </action>
          <action name="store" id="95849" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>store</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("wipeUserData")</condition>
          </action>
          <action name="index" id="95857" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>index</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("wipeUserData")</condition>
          </action>
          <action name="derby" id="109912" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                  <void property="file">
                    <object class="java.io.File">
                      <string>derby</string>
                    </object>
                  </void>
                  <void property="recurse">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("wipeUserData")</condition>
          </action>
          <action name="" id="12" beanClass="com.install4j.runtime.beans.actions.UninstallFilesAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.UninstallFilesAction" />
              </java>
            </serializedBean>
            <condition />
          </action>
        </actions>
        <formComponents />
      </screen>
      <screen name="" id="14" beanClass="com.install4j.runtime.beans.screens.UninstallFailureScreen" rollbackBarrier="false" backButton="2" finishScreen="true">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.UninstallFailureScreen" />
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions />
        <formComponents />
      </screen>
      <screen name="" id="13" beanClass="com.install4j.runtime.beans.screens.UninstallSuccessScreen" rollbackBarrier="false" backButton="2" finishScreen="true">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.UninstallSuccessScreen">
              <void property="bannerBackground">
                <object class="java.awt.Color">
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                  <int>255</int>
                </object>
              </void>
              <void property="bannerImageFile">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/installer_banner.png</string>
                </object>
              </void>
            </object>
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions />
        <formComponents />
      </screen>
    </uninstallerScreens>
    <installerStartup>
      <screen name="" id="15" beanClass="com.install4j.runtime.beans.screens.StartupScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.StartupScreen" />
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions>
          <action name="sys.installationDir" id="275921" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>String installDir = context.getVariable("sys.installationDir").toString();
if (installDir.indexOf(" ") &gt;= 0) {
    if (Util.isWindows())
        return "C:\\zimbra\\zdesktop";
    else
        return context.getVariable("sys.userHome").toString() + "/zdesktop";
} else
    return installDir;</string>
                      </void>
                    </object>
                  </void>
                  <void property="variableName">
                    <string>sys.installationDir</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="needToUninstall" id="275892" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>String appId = context.getApplicationId();

ApplicationRegistry.ApplicationInfo[] appInfoList = ApplicationRegistry.getApplicationInfoById(appId);
if (appInfoList != null &amp;&amp; appInfoList.length &gt; 0) {
    return Boolean.TRUE;
}

return Boolean.FALSE;</string>
                      </void>
                    </object>
                  </void>
                  <void property="variableName">
                    <string>needToUninstall</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
          </action>
          <action name="keepUserData" id="275893" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                  <void property="script">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>File install = context.getDestinationFile(".");
File[] dirs = install.listFiles();
for (int i = 0; i &lt; dirs.length; ++i) {
    if (dirs[i].isDirectory() &amp;&amp; dirs[i].getName().equals("derby")) {
        return Boolean.TRUE;
    }
}
return Boolean.FALSE;</string>
                      </void>
                    </object>
                  </void>
                  <void property="variableName">
                    <string>keepUserData</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("needToUninstall")</condition>
          </action>
        </actions>
        <formComponents />
      </screen>
    </installerStartup>
    <uninstallerStartup>
      <screen name="" id="16" beanClass="com.install4j.runtime.beans.screens.StartupScreen" rollbackBarrier="false" backButton="2" finishScreen="false">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.screens.StartupScreen" />
          </java>
        </serializedBean>
        <condition />
        <validation />
        <actions />
        <formComponents />
      </screen>
    </uninstallerStartup>
  </installerGui>
  <mediaSets>
    <win32 name="Windows" id="198394" mediaFileName="${compiler:sys.shortName}_${compiler:offline_version}_build_${compiler:offline_buildid}_win32" installDir="." overridePrincipalLanguage="false" requires64bit="false" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" includedJRE="windows-x86-1.5.0_10_us_only" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" customInstallBaseDir="C:\zimbra\zdesktop" createUninstallIcon="true" contentFilesType="1" downloadURL="" runAsAdmin="false">
      <excludedLaunchers />
      <excludedComponents />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="macos" launcher="false" />
        <entry location="linux" launcher="false" />
      </exclude>
      <variables />
      <excludedInstallerScreens />
      <excludedUninstallerScreens />
    </win32>
    <unixInstaller name="Unix" id="59040" mediaFileName="${compiler:sys.shortName}_${compiler:offline_version}_build_${compiler:offline_buildid}_linux_i686" installDir="." overridePrincipalLanguage="false" requires64bit="false" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" includedJRE="linux-x86-1.5.0_11" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" customInstallBaseDir="~/zimbra/zdesktop" createUninstallIcon="true" contentFilesType="1" downloadURL="">
      <excludedLaunchers />
      <excludedComponents />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="win32" launcher="false" />
        <entry location="macos" launcher="false" />
      </exclude>
      <variables />
      <excludedInstallerScreens />
      <excludedUninstallerScreens />
      <installerScript mode="1" file="">
        <scriptLines />
      </installerScript>
    </unixInstaller>
    <macosFolder name="Mac OS X Intel" id="44" mediaFileName="${compiler:sys.shortName}_${compiler:offline_version}_build_${compiler:offline_buildid}_macos_intel" installDir="." overridePrincipalLanguage="false" requires64bit="false" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" customInstallBaseDir="~/zimbra/zdesktop" createUninstallIcon="true" contentFilesType="1" downloadURL="">
      <excludedLaunchers />
      <excludedComponents />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="win32" launcher="false" />
        <entry location="linux" launcher="false" />
      </exclude>
      <variables />
      <excludedInstallerScreens />
      <excludedUninstallerScreens />
    </macosFolder>
  </mediaSets>
  <buildIds buildAll="false">
    <mediaSet refId="44" />
  </buildIds>
</install4j>

