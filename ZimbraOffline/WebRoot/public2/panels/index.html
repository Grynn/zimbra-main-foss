<html>
<head>
	<title>Offline Panel Tester</title>
	<script language='javascript' src='../Ajax.js'></script>
	<script language='javascript' src='../common.js'></script>
	<script language='javascript'>

		//
		//	Override JSP methods to make sense in the test environment
		//

		// override Ajax.show() and Ajax.hide() to load a file into the 'display' div
		Ajax.showPanel = function(id) {
			// load the panel
			var text = Ajax.XHR.getFile(id+".jsp?ts="+(new Date().getTime()));

			// get rid of JSP tags so it looks good
			text = Ajax.stripJSPTags(text);

			// show it in the display DIV and make sure it is shown
			Ajax.set("TESTdisplay", text);
			Ajax.show(id);

			// hilite the right entry in the list
			tester.hilitePanelList(id);

			// remember it for reload
			Ajax.setCookie("TESTid", id);
		}



		// override the showXPage methods
		function showAccountsPage() {
			Ajax.showPanel('newAccount');
		}

		function showServicesPage() {
			Ajax.showPanel('newService');
		}

		var tester = {
			// list the panel files here w/o the ".jsp" extension
			// The order here is the order they will be displayed in the list
			// Start an item with "-" to have it be a header row (label only)
			// REMEMBER TO UPDATE THIS WHEN YOU ADD A PANEL OR IT WON'T SHOW UP IN THE LIST
			panels : [
				'welcome',
				'accountType',
				'console',
				
				'-Zimbra Accounts',
//				'manageAccounts',
				'newAccount',
				'changeAccount_i',
				'accountCreated',
//				'accountDeleted',
//				'accountModified',
//				'accountReset',
	
				'-POP/IMAP Services',
//				'manageServices',
				'newService',
				'changeService_i',
				'serviceCreated',
//				'serviceDeleted',
//				'serviceModified',
	
				
				'-Settings',
				'proxy',
//				'smtp',
//				'smtpSaved',
//				'changesSaved'
			],
	
			hilitePanelList : function(id) {
				// hilite the item in the list
				for (var i = 0; i < tester.panels.length; i++) {
					var panel = tester.panels[i];
					var panelElement = Ajax.byId("TESTlistItem-"+panel);
					if (!panelElement) continue;
					if (panel == id) {
						panelElement.className = "TESTfileListItem TESTfileListItemSelected";
					} else {
						panelElement.className = "TESTfileListItem";
					}
				}
			},

			init : function () {
				// write the list of files into the fileList
				var output = [];
				for (var i = 0; i < tester.panels.length; i++) {
					var panel = tester.panels[i];
					if (panel[0] == "-") {
						output.push("<div class='TESTfileListHeader'>",panel.substring(1),"<\/div>");
					} else {
						output.push("<div id='TESTlistItem-",panel,"' class='TESTfileListItem' ",
										"onclick='Ajax.showPanel(\"", panel, "\")'>",
										panel,
									"<\/div>");					
					}
				}
				Ajax.set("TESTfileList", output.join(""));
				
				
				// show the first page in the list
				Ajax.showPanel(Ajax.getCookie("TESTid") || tester.panels[0]);
			}
		}


	/*** TODO: Move these into base file ***/
	function togglePopSettings(show) {
		show = (show == true);
		Ajax.toggle("pop_settings_folder_row", show);
		Ajax.toggle("pop_settings_delete_row", show);
	}
	
	function toggleSmtpAuthSettings(show) {
		show = (show == true);
		Ajax.toggle("smtp_auth_settings_row", show);
	}


	function deleteAccountWarning() {
		if (confirm("Permanently remove the account and all downloaded mail messages on this computer?  "
					+ "(You will still be able to access the account through your web browser).")) {
			Ajax.showPanel("accountDeleted");					
		}
	}
	
	function resetAccountWarning() {
		if (confirm("Clear mail messages from this machine and resynchronize with the server?")) {
			Ajax.showPanel("accountReset");					
		}	
	}

	</script>
	
	<style type='text/css'>
		/* styles for the tester itself */
		@import url(TESTER.css);
		/* snapshot of styles from the app */
		@import url(TEST.css);
		/* offline-specific styles */
		@import url(../offline.css);
	</style>
</head>
<body onload='tester.init()'>
	<div id='TESTfileList'>files</div>
	<div id='TESTdisplay'>display</div>
</body>
</html>