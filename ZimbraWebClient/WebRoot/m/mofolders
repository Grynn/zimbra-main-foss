<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="mo" uri="com.zimbra.mobileclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="com.zimbra.i18n" %>
<mo:handleError>
    <zm:getMailbox var="mailbox"/>
    <c:choose>
    <c:when test="${not empty mailbox.prefs.locale}">
        <fmt:setLocale value='${mailbox.prefs.locale}' scope='request' />
    </c:when>
    <c:otherwise>
        <fmt:setLocale value='${pageContext.request.locale}' scope='request' />
    </c:otherwise>
    </c:choose>
    <fmt:setBundle basename="/messages/ZhMsg" scope="request"/>

    <fmt:message var="title" key="MO_mailFoldersTags"/>
</mo:handleError>
<c:set var="context_url" value="${requestScope.baseURL!=null?requestScope.baseURL:'mosearch'}"/>
<mo:view title="${title}" context="${null}" mailbox="${mailbox}">
    <c:if test="${uiv != '1'}">
    <table width="100%" cellspacing="0" cellpadding="0">
        <tr class='ToolbarBg'>
            <td>
                <table width="100%" cellspacing="0" cellpadding="0" border="0">
                    <tr>
                        <td>
                            <table cellspacing="0" cellpadding="0">
                                <tr>
                                    <td><a href="main" class='zo_leftbutton'><fmt:message key="MO_MAIN"/></a></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    </c:if>
    <table width="100%" cellspacing="0" cellpadding="2" border="0">
        <tr class="ToolbarBg">
            <td class="Title">
			   <fmt:message key="folders"/>
            </td>
        </tr>
        <c:if test="${param.sq == null || param.sq == '' || fn:containsIgnoreCase(mailbox.inbox.name,param.sq)}">
            <mo:overviewFolder base="${context_url}" folder="${mailbox.inbox}"/>
            <mo:doFolderTree skiproot="${true}" parentid="${mailbox.inbox.id}" skipsystem="false"/>
        </c:if>
        <c:if test="${param.sq == null || param.sq == '' ||fn:containsIgnoreCase(mailbox.sent.name,param.sq)}">
             <mo:overviewFolder base="${context_url}" folder="${mailbox.sent}"/>
            <mo:doFolderTree skiproot="${true}" parentid="${mailbox.sent.id}" skipsystem="false"/>
        </c:if>
        <c:if test="${param.sq == null || param.sq == '' ||fn:containsIgnoreCase(mailbox.drafts.name,param.sq)}">
            <mo:overviewFolder base="${context_url}" folder="${mailbox.drafts}"/>
            <mo:doFolderTree skiproot="${true}" parentid="${mailbox.drafts.id}" skipsystem="false"/>
        </c:if>
        <c:if test="${param.sq == null || param.sq == '' ||fn:containsIgnoreCase(mailbox.spam.name,param.sq)}">
            <mo:overviewFolder base="${context_url}" folder="${mailbox.spam}"/>
            <mo:doFolderTree skiproot="${true}" parentid="${mailbox.spam.id}" skipsystem="false"/>
        </c:if>
        <c:if test="${param.sq == null || param.sq == '' ||fn:containsIgnoreCase(mailbox.trash.name,param.sq)}">
            <mo:overviewFolder base="${context_url}" folder="${mailbox.trash}"/>
            <mo:doFolderTree skiproot="${true}" parentid="${mailbox.trash.id}" skipsystem="false"/>
        </c:if>
        <mo:doFolderTree skiproot="${true}" skipsystem="${true}" skiptopsearch="${true}"/>

        <tr class="ToolbarBg">
            <td class="Title">
           <fmt:message key="searches"/>
            </td>
        </tr>
        <zm:forEachFolder var="folder" skipsystem="${true}">
            <c:if test="${(param.sq != null && param.sq != '' && fn:containsIgnoreCase(folder.name,param.sq)) || folder.isSearchFolder and (folder.depth eq 0)}">
                <mo:overviewSearchFolder folder="${folder}"/>
            </c:if>
        </zm:forEachFolder>
        <tr class="ToolbarBg">
            <td class="Title">
                <fmt:message key="tags"/>
            </td>
        </tr>

        <zm:forEachTag var="tag">
            <mo:overviewTag calendars="${false}" tag="${tag}" skiptypes="${uiv == '1'}"/>
        </zm:forEachTag>
    </table>
</mo:view>
 
