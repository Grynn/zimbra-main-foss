<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="mo" uri="com.zimbra.mobileclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="com.zimbra.i18n" %>
<c:set var="context_url" value="${requestScope.baseURL!=null?requestScope.baseURL:'mainx'}"/>
<c:set var="caction" value="${context_url}"/>
<c:if test="${param.bt != null}">
    <c:set var="bt" value="${param.bt}"/>
    <c:url var="caction" value='${context_url}?${fn:replace(param.bt,"|","&")}'/>
</c:if>
<c:if test="${param.bt == null}">
    <c:set var="caction" value='${header["referer"]}'/>
    <c:set var="bt" value="${fn:replace(fn:substringAfter(header['referer'],'?'),'&','|')}"/>
</c:if>
<mo:handleError>
    <zm:getMailbox var="mailbox"/>
    <c:choose>
    <c:when test="${not empty mailbox.prefs.locale}">
        <fmt:setLocale value='${mailbox.prefs.locale}' scope='request' />
    </c:when>
    <c:otherwise>
        <fmt:setLocale value='${pageContext.request.locale}' scope='request' />
    </c:otherwise>
    </c:choose>
    <fmt:setBundle basename="/messages/ZhMsg" scope="request"/>
    
    <c:set var="action" value="${zm:cook(empty param.paction ? param.action : param.paction)}" scope="request"/>
    <zm:computeSearchContext var="context" usecache="true"/>
</mo:handleError>
<mo:view title="${mailbox.name}" context="${context}" mailbox="${mailbox}">
<c:set var="context_url" value="${requestScope.baseURL!=null?requestScope.baseURL:'/m/main'}"/>
<c:set var="action_url" value="${uiv == '1'? context_url:'/m/mosearch'}"/>
<form action="<c:url value="${action_url}"/>" method="post">
<input type="hidden" name="crumb" value="${fn:escapeXml(mailbox.accountInfo.crumb)}"/>
<input type="hidden" name="bt" value="${bt}"/>
<div width="100%" cellspacing="0" cellpadding="0">
<div>
    <span class="searchbar">
                <div width="100%" cellspacing="0" cellpadding="0">
                    <div class='ToolbarBg'>
                        <span>
                            <div cellspacing="0" cellpadding="0">
                                <div>
                                    <span>
                                        <a href="${caction}" class='button'>
                                            <fmt:message key="back"/>
                                        </a>
                                    </span>
                                    <span style='padding-left:5px' class='zo_tb_submit'>
                                        <input name="actionSearch" type="submit" value="<fmt:message key="search"/>"/>
                                    </span>
                                </div>
                            </div>
                        </span>
                    </div>
                </div>
        
    </span>
</div>
<div>
<span class="data">

<div width="100%" cellspacing="2" cellpadding="5" class='zo_query'>
<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="find"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <input type="text" name="sq" style='width:100%'/>
    </span>
</div>
<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="MO_in"/>:</label>
    </span>
    <span class='zo_query_fvalue'>
        <select name="st" style='width:100%'>
            <option value="${mailbox.features.conversations ? mailbox.prefs.groupMailBy : 'message'}">
                <fmt:message key="searchMail"/>
            </option>
            <c:if test="${mailbox.features.contacts}">
                <option value="contact">
                    <fmt:message key="searchPersonalContacts"/>
                </option>
            </c:if>
        </select>
    </span>
</div>
<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="folder"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <select name="sq_folder" style='width:100%'>
            <option value="">
                <fmt:message key="MO_selectFolder"/>
            </option>
            <zm:forEachFolder var="folder">
                <c:if test="${(folder.isMailView or folder.isContactView) and not (folder.isSearchFolder or folder.isChats)}">
                    <option value=' in:"${folder.rootRelativePath}"'>
                            ${fn:escapeXml(folder.rootRelativePath)}
                    </option>
                </c:if>
            </zm:forEachFolder>
        </select>
    </span>
</div>
<c:if test="${mailbox.features.tagging}">
    <div>
        <span class='zo_query_fname'><label>
            <fmt:message key="MO_tag"/>:
        </label>
        </span>
        <span class='zo_query_fvalue'>
            <select name="sq_tag" style='width:100%'>
                <option value=""><fmt:message key="MO_selectTag"/></option>
                <zm:forEachTag var="tag">
                    <option value=' tag:"${tag.name}"'>
                            ${fn:escapeXml(tag.name)}
                    </option>
                </zm:forEachTag>
            </select>
        </span>
    </div>
</c:if>
<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="MO_size"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <div>
            <div>
                <span>
                    <select name="sq_size_comp">
                        <option value="larger"><fmt:message key="MO_larger"/></option>
                        <option value="smaller"><fmt:message key="MO_smaller"/></option>
                    </select>
                </span>
                <span>
                    <input type="text" name="sq_size" size="5"/>
                </span>
                <span>
                    <select name="sq_size_units">
                        <option value="kb">KB</option>
                        <option value="mb">MB</option>
                    </select>
                </span>
            </div>
        </div>
    </span>
</div>


<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="status"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <div>
            <div>
                <span>
                    <div>
                        <div valign="middle">
                            <span class='zo_query_fvalue'><input id="unread" type="checkbox" name="sq_unread" value=" is:unread"/></span>
                            <span class='zo_query_fname'><label for="unread"><fmt:message key="MO_unread"/></label></span>

                        </div>
                    </div>
                </span>
                <span>
                    <div>
                        <div>
                            <span class='zo_query_fvalue'><input id="flagged" type="checkbox" name="sq_flagged" value=" is:flagged"/></span>
                            <span class='zo_query_fname'><label for="flagged"><fmt:message key="MO_flagged"/></label></span>
                        </div>
                    </div>
                </span>
            </div>
        </div>
    </span>
</div>


<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="from"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <input type="text" name="sq_from" style='width:100%'/>
    </span>
</div>


<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="MO_tocc"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <input type="text" name="sq_tocc" style='width:100%'/>
    </span>
</div>

<div>
    <span class='zo_query_fname'><label>
        <fmt:message key="subject"/>:
    </label>
    </span>
    <span class='zo_query_fvalue'>
        <input type="text" name="sq_subject" style='width:100%'/>
    </span>
</div>

</div>

</span>
</div>
<div>
    <span class="searchbar">
                <div width="100%" cellspacing="0" cellpadding="0">
                    <div class='ToolbarBg'>
                        <span>
                            <div cellspacing="0" cellpadding="0">
                                <div>
                                    <span>
                                        <a href="${caction}" class='button'>
                                            <fmt:message key="back"/>
                                        </a>
                                    </span>
                                    <span style='padding-left:5px' class='zo_tb_submit'>
                                        <input name="actionSearch" type="submit" value="<fmt:message key="search"/>"/>
                                    </span>
                                </div>
                            </div>
                        </span>
                    </div>
                </div>
    </span>
</div>
</div>
</form>
</mo:view>
