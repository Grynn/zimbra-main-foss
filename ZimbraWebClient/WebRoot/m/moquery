<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="mo" uri="com.zimbra.mobileclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="com.zimbra.i18n" %>

<mo:handleError>
    <zm:getMailbox var="mailbox"/>
    <c:choose>
    <c:when test="${not empty mailbox.prefs.locale}">
        <fmt:setLocale value='${mailbox.prefs.locale}' scope='request' />
    </c:when>
    <c:otherwise>
        <fmt:setLocale value='${pageContext.request.locale}' scope='request' />
    </c:otherwise>
    </c:choose>
    <fmt:setBundle basename="/messages/ZhMsg" scope="request"/>
    
    <c:set var="action" value="${zm:cook(empty param.paction ? param.action : param.paction)}" scope="request"/>
    <zm:computeSearchContext var="context" usecache="true"/>
</mo:handleError>
<mo:view title="${mailbox.name}" context="${context}" mailbox="${mailbox}">
<c:set var="context_url" value="${requestScope.baseURL!=null?requestScope.baseURL:'/m/main'}"/>
<c:set var="action_url" value="${uiv == '1'? context_url:'/m/mosearch'}"/>
<form action="<c:url value="${action_url}"/>" method="post">
<input type="hidden" name="crumb" value="${fn:escapeXml(mailbox.accountInfo.crumb)}"/>
<table width="100%" cellspacing="0" cellpadding="0">
<tr>
    <td class="searchbar">
                <table width="100%" cellspacing="0" cellpadding="0">
                    <tr class='ToolbarBg'>
                        <td>
                            <table cellspacing="0" cellpadding="0">
                                <tr>
                                    <td>
                                        <a href="${context_url}" class='zo_leftbutton'>
                                            <fmt:message key="MO_MAIN"/>
                                        </a>
                                    </td>
                                    <td style='padding-left:5px' class='zo_tb_submit'>
                                        <input name="actionSearch" type="submit" value="<fmt:message key="search"/>"/>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
        
    </td>
</tr>
<tr>
<td class="data">

<table width="100%" cellspacing="2" cellpadding="5" class='zo_query'>
<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="find"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <input type="text" name="sq" style='width:100%'/>
    </td>
</tr>
<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="MO_in"/>:</label>
    </td>
    <td class='zo_query_fvalue'>
        <select name="st" style='width:100%'>
            <option value="${mailbox.features.conversations ? mailbox.prefs.groupMailBy : 'message'}">
                <fmt:message key="searchMail"/>
            </option>
            <c:if test="${mailbox.features.contacts}">
                <option value="contact">
                    <fmt:message key="searchPersonalContacts"/>
                </option>
            </c:if>
        </select>
    </td>
</tr>
<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="folder"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <select name="sq_folder" style='width:100%'>
            <option value="">
                <fmt:message key="MO_selectFolder"/>
            </option>
            <zm:forEachFolder var="folder">
                <c:if test="${(folder.isMailView or folder.isContactView) and not (folder.isSearchFolder or folder.isChats)}">
                    <option value=' in:"${folder.rootRelativePath}"'>
                            ${fn:escapeXml(folder.rootRelativePath)}
                    </option>
                </c:if>
            </zm:forEachFolder>
        </select>
    </td>
</tr>
<c:if test="${mailbox.features.tagging}">
    <tr>
        <td class='zo_query_fname'><label>
            <fmt:message key="MO_tag"/>:
        </label>
        </td>
        <td class='zo_query_fvalue'>
            <select name="sq_tag" style='width:100%'>
                <option value=""><fmt:message key="MO_selectTag"/></option>
                <zm:forEachTag var="tag">
                    <option value=' tag:"${tag.name}"'>
                            ${fn:escapeXml(tag.name)}
                    </option>
                </zm:forEachTag>
            </select>
        </td>
    </tr>
</c:if>
<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="MO_size"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <table>
            <tr>
                <td>
                    <select name="sq_size_comp">
                        <option value="larger"><fmt:message key="MO_larger"/></option>
                        <option value="smaller"><fmt:message key="MO_smaller"/></option>
                    </select>
                </td>
                <td>
                    <input type="text" name="sq_size" size="5"/>
                </td>
                <td>
                    <select name="sq_size_units">
                        <option value="kb">KB</option>
                        <option value="mb">MB</option>
                    </select>
                </td>
            </tr>
        </table>
    </td>
</tr>


<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="status"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <table>
            <tr>
                <td>
                    <table>
                        <tr valign="middle">
                            <td class='zo_query_fvalue'><input id="unread" type="checkbox" name="sq_unread" value=" is:unread"/></td>
                            <td class='zo_query_fname'><label for="unread"><fmt:message key="MO_unread"/></label></td>

                        </tr>
                    </table>
                </td>
                <td>
                    <table>
                        <tr>
                            <td class='zo_query_fvalue'><input id="flagged" type="checkbox" name="sq_flagged" value=" is:flagged"/></td>
                            <td class='zo_query_fname'><label for="flagged"><fmt:message key="MO_flagged"/></label></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </td>
</tr>


<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="from"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <input type="text" name="sq_from" style='width:100%'/>
    </td>
</tr>


<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="MO_tocc"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <input type="text" name="sq_tocc" style='width:100%'/>
    </td>
</tr>

<tr>
    <td class='zo_query_fname'><label>
        <fmt:message key="subject"/>:
    </label>
    </td>
    <td class='zo_query_fvalue'>
        <input type="text" name="sq_subject" style='width:100%'/>
    </td>
</tr>

</table>

</td>
</tr>
<tr>
    <td class="searchbar">
                <table width="100%" cellspacing="0" cellpadding="0">
                    <tr class='ToolbarBg'>
                        <td>
                            <table cellspacing="0" cellpadding="0">
                                <tr>
                                    <td>
                                        <a href="${context_url}" class='zo_leftbutton'>
                                            <fmt:message key="MO_MAIN"/>
                                        </a>
                                    </td>
                                    <td style='padding-left:5px' class='zo_tb_submit'>
                                        <input name="actionSearch" type="submit" value="<fmt:message key="search"/>"/>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
    </td>
</tr>
</table>
</form>
</mo:view>
