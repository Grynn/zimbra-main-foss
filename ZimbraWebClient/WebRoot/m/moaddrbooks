<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="mo" uri="com.zimbra.mobileclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="com.zimbra.i18n" %>
<mo:handleError>
    <zm:getMailbox var="mailbox"/>
    <c:choose>
        <c:when test="${not empty mailbox.prefs.locale}">
            <fmt:setLocale value='${mailbox.prefs.locale}' scope='request'/>
        </c:when>
        <c:otherwise>
            <fmt:setLocale value='${pageContext.request.locale}' scope='request'/>
        </c:otherwise>
    </c:choose>
    <fmt:setBundle basename="/messages/ZhMsg" scope="request"/>

    <fmt:message var="title" key="MO_mailFoldersTags"/>
    <c:if test="${not empty param.doFolderAction}">
        <mo:folderAction/>
    </c:if>
</mo:handleError>
<c:set var="context_url" value="${requestScope.baseURL!=null?requestScope.baseURL:'mosearch'}"/>
<mo:view title="${title}" context="${null}" mailbox="${mailbox}">
<c:if test="${uiv != '1'}">
    <table width="100%" cellspacing="0" cellpadding="0">
        <tr>
            <td>
                <table width="100%" cellspacing="0" cellpadding="0" border="0">
                    <tr class='zo_toolbar'>
                        <td>
                            <table cellspacing="0" cellpadding="0">
                                <tr>
                                    <td><a href="main" class='zo_leftbutton'><fmt:message key="MO_MAIN"/></a></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</c:if>
<table width="100%" cellspacing="0" cellpadding="0" border="0">
    <tr>
        <td>
            <table width="100%" class="ToolbarBg">
                <tr>
                    <td class="Title">
                        <fmt:message key="addressBooks"/>
                    </td>
                    <c:if test="${mailbox.accountInfo.attrs.zimbraFeatureNewAddrBookEnabled[0]=='TRUE'}">

                        <td align="right">
                           <a href="?st=ab${empty param.showABCreate?'&showABCreate=1':''}#abooks" onclick="return showHideElemForm('naddrfrm');"><fmt:message
                                    key="create"/></a>
                        </td>
                    </c:if>

                </tr>
            </table>
            <c:if test="${mailbox.accountInfo.attrs.zimbraFeatureNewAddrBookEnabled[0]=='TRUE'}">
            <div class="View" id="naddrfrm" style="${empty param.showABCreate?'display:none':''};margin:2px;">
                <form action="" method="post" style="padding:0px;margin:0px;">
                    <input type="hidden" name="doFolderAction" value="1">
                    <input name="crumb" type="hidden" value="${fn:escapeXml(mailbox.accountInfo.crumb)}"/>
                    <span class="label"><fmt:message key="name"/>:</span><input type="text" name="folder_name"
                                                                                 style="width:100px;">
                    <fmt:message key="in"/>: <select name="parentid" style="width:100px;">
                    <option value="${mailbox.contacts.parentId}">--<fmt:message key="folder"/>--</option>
                    <zm:forEachFolder var="fldr" parentid="${mailbox.contacts.parentId}" skiproot="false" skiptrash="true">
                        <c:if test="${fldr.isContactView}">
                            <option value="${fldr.id}">${fn:escapeXml(fldr.rootRelativePath)}</option>
                        </c:if>
                    </zm:forEachFolder>
                  </select>
                    <input type="submit" name="actionSaveAddrFolder" value="<fmt:message key='save'/>">
                </form>
            </div>
            <a name="folders" style="padding:0px;margin:0px;"/>    
            </c:if>
       </td>
    </tr>        
    <mo:doContactFolderTree skiproot="${false}" skipsystem="false" skiptrash="true"/>

    <mo:overviewFolder types="contact" folder="${mailbox.trash}" base="${context_url}"/>
    <mo:doContactFolderTree skiproot="${true}" parentid="${mailbox.trash.id}" skipsystem="false"/>
    <tr>
        <td>
            <table width="100%" class="ToolbarBg">
                <tr>
                    <td class="Title">
                        <fmt:message key="tags"/>
                    </td>

                    <td align="right">
                        <a href="?st=ab${empty param.showTagCreate?'&showTagCreate=1':''}#tags" onclick="return showHideElemForm('ntagfrm');"><fmt:message
                                key="create"/></a>
                    </td>
                </tr>
            </table>
            <div class="View" id="ntagfrm" style="${empty param.showTagCreate?'display:none':''};margin:2px;">
                <form action="" method="post" style="padding:0px;margin:0px;">
                    <input type="hidden" name="doFolderAction" value="1">
                    <input name="crumb" type="hidden" value="${fn:escapeXml(mailbox.accountInfo.crumb)}"/>
                    <span class="label"><fmt:message key="name"/>:</span> <input type="text" style="width:100px;">
                    <select name="tag_color">
                        <optgroup label="<fmt:message key='color'/>">
                            <option value="cyan"><fmt:message key="cyan"/></option>
                            <option value="blue"><fmt:message key="blue"/></option>
                            <option value="purple"><fmt:message key="purple"/></option>
                            <option value="red"><fmt:message key="red"/></option>
                            <option value="orange"><fmt:message key="orange"/></option>
                            <option value="yellow"><fmt:message key="yellow"/></option>
                            <option value="green"><fmt:message key="green"/></option>
                        </optgroup>
                    </select>
                    <input type="submit" name="actionSaveTag" value="<fmt:message key='save'/>">
                </form>
            </div>
           <a name="tags" style="padding:0px;margin:0px;"/>
        </td>
    </tr>

    <zm:forEachTag var="tag">
        <mo:overviewTag calendars="${false}" tag="${tag}" types="contact"/>
    </zm:forEachTag>
</table>
<script type="text/javascript">
    var showHideElemForm = function(elemId) {
        var elem = document.getElementById(elemId)
        if (!elem) return;
        if (elem.style.display == 'none') {
            elem.style.display = '';
        } else {
            elem.style.display = 'none';
        }
        return false;
    }
</script>
</mo:view>
 