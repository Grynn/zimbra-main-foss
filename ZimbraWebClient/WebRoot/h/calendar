<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<fmt:setBundle basename="/msgs/ZhMsg" scope="session"/>

<app:handleError>
    <jsp:useBean id="expanded" scope="session" class="java.util.HashMap" />

     <c:if test="${not empty param.expand}">
         <c:set target="${sessionScope.expanded}" property="${param.expand}" value="expand"/>
     </c:if>
     <c:if test="${not empty param.collapse}">
         <c:set target="${sessionScope.expanded}" property="${param.collapse}" value="collapse"/>
     </c:if>
     
    <zm:getMailbox var="mailbox"/>
    <zm:computeSearchContext var="context" usecache="true"/>
    <c:choose>
        <c:when test="${not empty param.date}">
            <fmt:parseDate var="date" pattern="yyyyMMdd" value="${param.date}"/>
        </c:when>
        <c:otherwise>
            <c:set var="date" value="${zm:getToday().time}"/>
        </c:otherwise>
    </c:choose>

    <c:if test="${not empty param.check}">
        <zm:checkFolder checked="true" id="${param.check}"/>
    </c:if>
    <c:if test="${not empty param.uncheck}">
        <zm:checkFolder checked="false" id="${param.uncheck}"/>
    </c:if>
</app:handleError>

<c:choose>
    <c:when test="${param.view eq 'day'}">
        <app:dayView date="${date}"/>
    </c:when>
    <c:when test="${param.view eq 'workWeek'}">
        <app:multiDayView date="${date}" days="5"/>
    </c:when>
    <c:otherwise>
        <app:monthView date="${date}"/>
    </c:otherwise>
</c:choose>

