<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<fmt:setBundle basename="/msgs/ZhMsg" scope="session"/>
 <app:composeCheck/>
<jsp:useBean id="expanded" scope="session" class="java.util.HashMap" />
 <app:handleError>

     <c:if test="${not empty param.expand}">

         <c:set target="${sessionScope.expanded}" property="${param.expand}" value="expand"/>
     </c:if>
     <c:if test="${not empty param.collapse}">
         
         <c:set target="${sessionScope.expanded}" property="${param.collapse}" value="collapse"/>
     </c:if>
     
     <%-- switch based on context saerch types --%>
     <c:if test="${not empty param.doAction}">
         <zm:computeSearchContext var="context" usecache="true"/>
         <c:choose>
             <c:when test="${context.isConversationSearch}">
                 <app:convListViewAction/>
             </c:when>
             <c:when test="${context.isMessageSearch}">
                 <app:messageAction/>
         </c:when>
         <c:when test="${context.isContactSearch}">
             <app:contactListViewAction/>
         </c:when>
         <c:otherwise>
             <%--mixed view Types (${context.types}) --%>
         </c:otherwise>
         </c:choose>

     </c:if>

     <zm:computeSearchContext var="context" usecache="false"/>
     
</app:handleError>

     <c:choose>
         <c:when test="${context.isFolderSearch and context.folder.hasUnread}">
             <app:head title="${context.title} (${context.folder.unreadCount})"/>
         </c:when>
         <c:when test="${context.isTagSearch and context.tag.hasUnread}">
             <app:head title="${context.title} (${context.tag.unreadCount})"/>
         </c:when>
         <c:otherwise>
             <app:head title="${context.title}"/>
         </c:otherwise>
     </c:choose>

<body>
 <%-- switch based on context saerch types --%>
 <c:choose>
     <c:when test="${context.isConversationSearch}">
         <app:convListView context="${context}"/>
     </c:when>
     <c:when test="${context.isMessageSearch}">
         <app:messageListView context="${context}"/>
     </c:when>
     <c:when test="${context.isContactSearch}">
         <app:contactListView context="${context}"/>
     </c:when>
     <c:otherwise>
         mixed view Types (${context.types})
     </c:otherwise>
 </c:choose>

</body>
</html>
