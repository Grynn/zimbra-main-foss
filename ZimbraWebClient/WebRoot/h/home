<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlclient" %>
<%@ taglib prefix="mo" uri="com.zimbra.mobileclient" %>    
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<fmt:setBundle basename="/messages/ZhMsg" scope="session"/>

<app:handleError>
<zm:computeSearchContext var="context" usecache="true"/>
<zm:getMailbox var="mailbox"/>
<app:composeCheck/>
<c:set var="action" value="${empty param.paction ? param.action : param.paction}" scope="request"/>
<c:if test="${not empty param.expand}">
    <c:set target="${sessionScope.expanded}" property="${param.expand}" value="expand"/>
</c:if>
<c:if test="${not empty param.collapse}">
    <c:set target="${sessionScope.expanded}" property="${param.collapse}" value="collapse"/>
</c:if>
</app:handleError>

<c:if test="${param.mesg eq 'welcome'}">
<app:status style="info">
    <fmt:message key="htmlWelcomeMesg"/>
</app:status>
</c:if>

<c:set var="fullname" value="${fn:escapeXml(mailbox.defaultIdentity.fromDisplay)}"/>            
<c:set var="folder" value="${mailbox.inbox}"/>
<fmt:message key="inbox" var="label"/>
<c:url var="url" value="/h/${empty base ? 'search' : base}">
<c:param name="sfi" value="${folder.id}"/>
</c:url>
<app:handleError>
<zm:computeSearchContext var="context" usecache="true"/>
    <fmt:message var="unknownRecipient" key="unknownRecipient"/>
    <fmt:message var="noSubject" key="noSubject"/>
</app:handleError>

<c:set var="selected" value="${empty param.selected ? 'home' : param.selected}"/>
<app:view mailbox="${mailbox}" title="${fn:escapeXml(empty label ? folder.name : label)} ( ${folder.unreadCount})" context="${context}" selected='home' folders="true" tags="true" searches="true" keys="true">

<table width="100%" cellpadding="0" cellspacing="0" >
<tr>
    <td class='TbTop'>${toolbar}</td>
</tr>
<tr>
<td class='ZhAppContent' style="padding:7px;width:100%;height:100%;valign:top;">
<table width="100%" >
<tr>
    <td>
        <font style="font-size:14pt; color:#000000;">Hi! ${empty fullname ? mailbox.name : fullname}     </font>
    </td>
    <td>
        <font style="font-size:14pt; color:#000000;">
            <a style="color:#000000;" href='${url}'>${fn:escapeXml(empty label ? folder.name : label)}
                <c:if test="${folder.hasUnread}">&nbsp;(${folder.unreadCount}) </c:if>
            </a>
        </font>
    </td>
</tr>
<tr>
    <td>
        <table>
            <tr>
                <td>
                    Mail
                </td>
            </tr>
            <c:if test="${context.isMessageSearch}">
                <c:forEach items="${context.searchResult.hits}" var="hit" varStatus="status" begin="0" end="4">
                    <tr>
                        <zm:currentResultUrl var="convUrl" value="search" cid="${hit.id}" action='view' index="${status.index}" context="${context}" usecache="true"/>
                        <td style="border-bottom:1px solid #ccc;padding:5px;width:25%;"  ><a style="text-decoration:none;"  href="${convUrl}">${fn:escapeXml(empty hit.messageHit.displaySender ? unknownRecipient :  hit.messageHit.displaySender)}</a></td>
                        <td style="border-bottom:1px solid #ccc;padding:5px;text-decoration:none;"  ><a style="color:#000;text-decoration:none;" href="${convUrl}">
                            <c:set var='subj' value="${empty hit.messageHit.subject ? noSubject : zm:truncate(hit.messageHit.subject,80,true)}"/>
                            <c:out value="${subj}"/></a></td>
                    </tr>
                </c:forEach>
            </c:if>
            <c:if test="${context.isConversationSearch}">
                <c:forEach items="${context.searchResult.hits}" var="hit" varStatus="status" begin="0" end="4">
                    <tr>
                        <zm:currentResultUrl var="convUrl" value="search" cid="${hit.id}" action='view' index="${status.index}" context="${context}" usecache="true"/>
                        <td style="border-bottom:1px solid #ccc;padding:5px;width:25%;"  ><a style="text-decoration:none;"  href="${convUrl}">${fn:escapeXml(empty hit.conversationHit.displayRecipients ? unknownRecipient :  hit.conversationHit.displayRecipients)}</a></td>
                        <td style="border-bottom:1px solid #ccc;padding:5px;text-decoration:none;"  ><a style="color:#000;text-decoration:none;" href="${convUrl}" >
                            <c:set var='subj' value="${empty hit.conversationHit.subject ? noSubject : zm:truncate(hit.conversationHit.subject,80,true)}"/>
                            <c:out value="${subj}"/></a>
                        </td>
                    </tr>
                </c:forEach>
            </c:if>

        </table>
    </td>
    <td>
        <table>
            <%--
            <mo:handleError>
                <c:set var="tz" value="${mailbox.prefs.timeZone}" scope="request"/>
                <c:set scope="request" var="dateContext" value="${zm:getToday(tz)}"/>
                <c:set var="currentDay" value="${zm:getCalendar(date.timeInMillis,mailbox.prefs.timeZone)}"/>
                <c:set var="view" value="${'list'}"/>
                <c:set var="needViewAppt" value="${true}"/>
                <c:set var="id" value="0"/>
                <c:set var="count" value="0"/>
                <c:set var="dayStart" value="${currentDay.timeInMillis}"/>
                <c:set var="dayEnd" value="${zm:addDay(currentDay, 1).timeInMillis}"/>
                <c:set var="numDays" value="30"/>
                <c:set var="prevDate" value="${zm:addDay(date, -numDays)}"/>
                <c:set var="nextDate" value="${zm:addDay(date,  numDays)}"/>
                <c:set var="dateEnd" value="${zm:addDay(date,numDays-1)}"/>
                <c:set var="weekDays" value="${dateSymbols.weekdays}"/>
                <c:set var="today" value="${zm:getToday(timezone)}"/>

                <c:set var="checkedCalendars" value="${zm:getCheckedCalendarFolderIds(mailbox)}"/>
                <c:forEach var="day" begin="1" end="${numDays}">

                    <zm:forEachAppoinment var="appt" appointments="${appts}" start="${dayStart}" end="${dayEnd}">
                        <c:if test="${count eq 0}">
                            <tr class='zo_cal_listh'>
                                <td class='zo_cal_listh_dow'>
                                    <fmt:formatDate value="${appt.startDate}" pattern="${dayFormat}"/>
                                </td>
                                <td class='zo_cal_listh_date'>
                                    <fmt:formatDate value="${appt.startDate}" type="date" dateStyle="medium"/>
                                </td>
                            </tr>
                        </c:if>
                        <tr class='zo_cal_listi'  onclick='zClickLink("a${id}")'>
                            <td class='zo_cal_listi_time'>
                                <c:choose>
                                    <c:when test="${appt.allDay}">
                                        <fmt:message key="apptAllDay"/>
                                    </c:when>
                                    <c:when test="${appt.startTime lt dayStart}">
                                        <fmt:formatDate value="${appt.startDate}" type="date" dateStyle="short"/>
                                    </c:when>
                                    <c:otherwise>
                                        <fmt:formatDate value="${appt.startDate}" type="time" timeStyle="short"/>
                                    </c:otherwise>
                                </c:choose>
                            </td>
                            <mo:calendarUrl appt="${appt}" var="apptUrl"/>
                            <td class='zo_cal_listi_subject'>
                                <c:set var="subject" value="${empty appt.name ? noSubject : appt.name}"/>
                                <a id="a${id}" href="${apptUrl}">${fn:escapeXml(subject)}</a>
                            </td>
                        </tr>
                        <c:set var="count" value="${count+1}"/>
                        <c:set var="id" value="${id+1}"/>
                    </zm:forEachAppoinment>
                    ${zm:getNextDay(currentDay)}
                </c:forEach>
            </mo:handleError>
            --%>
        </table>
    </td>
</tr>
</table>
</td>
</tr>
</table>



</app:view>
        
