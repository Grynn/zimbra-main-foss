== Install Instructions for Intel Mac OS X ==

The following instructions detail how to get a development
environment setup for Zimbra on an Intel Mac running OS X. In
each section below, links to the necessary software is provided.
However, if inside Zimbra many of these packages are already 
downloaded and are available at http://kenny/public/software/ 
so try there first. 

Some notes on the software:

   * Perforce - install the latest version
   * MySQL - you MUST install the x86 version, version 5 (or higher)
   * OpenLDAP - install the latest version (Zimbra compiled in Perforce Thirdparty)


=== Perforce ===

Download and install client from http://perforce.com/perforce/downloads/macosx104x86.html

Setup p4 client with following information:

P4USER = {user_name}
P4PORT = depot:1666
P4CLIENT = {client_name}

P4 View:
		
		Only needed to get OpenLDAP for start of install:
		//depot/main/ThirdPartyBuilds/MACOSXx86/sleepcat/... //{client_name}/ThirdPartyBuilds/MACOSXx86/sleepycat/...
		//depot/main/ThirdPartyBuilds/MACOSXx86/openssl/... //{client_name}/ThirdPartyBuilds/MACOSXx86/openssl/...
		//depot/main/ThirdPartyBuilds/MACOSXx86/heimdal/... //{client_name}/ThirdPartyBuilds/MACOSXx86/heimdal/...
		//depot/main/ThirdPartyBuilds/MACOSXx86/curl/... //{client_name}/ThirdPartyBuilds/MACOSXx86/curl/...
		//depot/main/ThirdPartyBuilds/MACOSXx86/cyrus-sasl/... //{client_name}/ThirdPartyBuilds/MACOSXx86/cyrus-sasl/...
		//depot/main/ThirdPartyBuilds/MACOSXx86/openldap/... //{client_name}/ThirdPartyBuilds/MACOSXx86/openldap/...

		For the basic server only include:
        //depot/main/ZimbraServer/... //{client_name}/ZimbraServer/...
        //depot/main/ZimbraCommon/... //{client_name}/ZimbraCommon/...
        //depot/main/ZimbraIM/... //{client_name}/ZimbraIM/...
        //depot/main/ThirdParty/jetty/... //{client_name}/ThirdParty/jetty/...

		For the webclient also include
        //depot/main/Ajax/... //{client_name}/Ajax/...
        //depot/main/ZimbraWebClient/... //{client_name}/ZimbraWebClient/...
        //depot/main/ZimbraTagLib/... //{client_name}/ZimbraTagLib/...
        //depot/main/Zimlet/... //{client_name}/Zimlet/...

		If you are using IDEA Intellij include
        //depot/main/Zimbra.ipr //{client_name}/Zimbra.ipr

After you setup Perforce, login and sync the client. This will get
you all of the files that you will need for the rest of the install.


=== Setup /opt/zimbra ===

Open a terminal shell and run the following commands:

<pre>
% sudo su -
% mkdir -p /opt/zimbra
% chown {user_name}:{user_name} /opt/zimbra
% exit
</pre>


=== Install MySQL ===

Download and install from http://dev.mysql.com/downloads/mysql/5.0.html#macosx-dmg

Note: Install *both* packages so that MySQL will automatically start
when you boot.

Run the following commands:

<pre>
% sudo ln -s /usr/local/mysql /opt/zimbra/mysql
</pre>

Then edit the file /opt/zimbra/mysql/data/my.cnf, type in the
following, and save:

<pre>
[mysqld]
bind-address = localhost
port = 7306
</pre>

Now you should be able to start MySQL with the following command:
[Note: you will probably have to reboot in order for this to work]

<pre>
% sudo SystemStarter start MySQL
</pre>

Set the password to the ant expected "zimbra".  Start the mysql
client with

<pre>
% mysql -u root
</pre>

then enter

<pre>
mysql> UPDATE mysql.user SET Password = PASSWORD('zimbra') WHERE User='root';
mysql> FLUSH PRIVILEGES;
mysql> quit
</pre>

=== Install OpenLDAP ===

<pre>
% tar -xvzf  {p4_client_local_dir}/ThirdPartyBuilds/MACOSXx86/sleepycat/sleepycat-4.2.52.6.tgz -C /opt/zimbra
% tar -xvzf  {p4_client_local_dir}/ThirdPartyBuilds/MACOSXx86/openssl/openssl-0.9.8e.tgz -C /opt/zimbra
% tar -xvzf  {p4_client_local_dir}/ThirdPartyBuilds/MACOSXx86/heimdal/heimdal-1.0.1.tgz -C /opt/zimbra
% tar -xvzf  {p4_client_local_dir}/ThirdPartyBuilds/MACOSXx86/curl/curl-7.17.0.tgz -C /opt/zimbra
% tar -xvzf  {p4_client_local_dir}/ThirdPartyBuilds/MACOSXx86/cyrus-sasl/cyrus-sasl-2.1.22.3.tgz -C /opt/zimbra
% tar -xvzf  {p4_client_local_dir}/ThirdPartyBuilds/MACOSXx86/openldap/openldap-2.3.37.7.tgz -C /opt/zimbra
</pre>

Run the following command:

<pre>
% ln -s /opt/zimbra/{sleepycat_extract_dir} /opt/zimbra/sleepycat
% ln -s /opt/zimbra/{openssl_extract_dir} /opt/zimbra/openssl
% ln -s /opt/zimbra/{heimdal_extract_dir} /opt/zimbra/heimdal
% ln -s /opt/zimbra/{curl_extract_dir} /opt/zimbra/curl
% ln -s /opt/zimbra/{cyrus-sasl_extract_dir} /opt/zimbra/cyrus-sasl
% ln -s /opt/zimbra/{openldap_extract_dir} /opt/zimbra/openldap
</pre>

Then run "sudo visudo" and add the following at the
end of the file and save:

<pre>
{user_name}{TAB}ALL=NOPASSWD:/opt/zimbra/libexec/zmslapd
<pre>


=== Install Ant ===

Download from http://ant.apache.org/bindownload.cgi

Extract the .tar.gz file to someplace useful and add to your
PATH.

=== Deploy Zimbra ===

Deploy Zimbra with the following commands:

<pre>
% cd {p4_client_local_dir}/ZimbraServer
% ant reset-all
</pre>

You should now be able to point your browser to the following
URL and login with the username "user1" and password "test123":

<pre>
http://localhost:7070/zimbra/
</pre>


=== Install Mail Transfer Agent ===

In order to send mail to/from users in the Zimbra product
you will need a mail transfer agent. However, you do not need
a full MTA such as Postfix in order for this to work. Instead,
you can install a Perl script that acts as a simple MTA.

NOTE: In order to continue with this step, you need to have
installed the Mac OS X development tools. If you haven't done
this yet, insert disc 1 and install Xcode Tools/XcodeTools.mpkg

First, you need to install some Perl packages by running
the following commands: [The first time you run CPAN, you
will need to configure it -- use default settings where
possible]

<pre>
% sudo cpan
</pre>

At the CPAN prompt, type the following commands:

<pre>
cpan> install Net::SMTP::Server
cpan> install Net::LMTP
cpan> install Net::DNS
cpan> quit
</pre>

Now you can run the Perl MTA with the following commands:

<pre>
% export ZIMBRA_HOSTNAME=`/opt/zimbra/bin/zmhostname`
% sudo perl {p4_client_local_dir}/ZimbraServer/src/perl/zMTAHack.pl
</pre>

NOTE: When sending mail, you need to fully qualify the
address as {username}@{hostname}. The {username} is
"user1" through "user5". The {hostname} is the same one
that /opt/zimbra/bin/zmhostname displays.


=== Configuring Services to Start at Boot ===

At this point, only MySQL is configured to start at boot.
If you want the other services (i.e. LDAP and
MTA) to start at boot, you need to run the following
commands:

<pre>
TODO
</pre>
