#!/do/not/execute/this/script/it/is/meant/to/be/sourced -*- shell-script -*-
#
# zmshutil is meant to be sourced by other scripts.  If run
# it will do nothing.  It will complain if it can't find
# local config program.
#

#
# Find and set local config variables.
#
zmsetvars() {
	zmlocalconfig="/opt/zimbra/bin/zmlocalconfig"
	if [ ! -x "${zmlocalconfig}" ]; then 
	    echo Error: can not find zmlocalconfig program
	    exit 1
	fi

	if ! eval `${zmlocalconfig} -q -m shell "$@"`; then
		echo Error: executing: ${zmlocalconfig} -m shell "$@"
		exit 1
	fi

	for i in "$@"; do
    	if [ -z "${!i}" ]; then
			echo Error: local configkey $i is not set
			exit 1
	    fi
	done
}

#
# Check if a conditional expression is true.
#
zmassert() { 
    if [ $@ ]; then
    	return;
    fi
    echo Error: assertion "'$@'" failed && exit 1
}
